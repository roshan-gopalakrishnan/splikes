/* Generated by Pyrex 0.9.5.1a on Wed Jun 27 13:15:54 2007 */

#include "Python.h"
#include "structmember.h"
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
__PYX_EXTERN_C double pow(double, double);
#include "randmtzig.c"
#include "math.h"
#include "stdlib.h"
#include "numpy/arrayobject.h"


typedef struct {PyObject **p; char *s;} __Pyx_InternTabEntry; /*proto*/
typedef struct {PyObject **p; char *s; long n;} __Pyx_StringTabEntry; /*proto*/

static PyObject *__pyx_m;
static PyObject *__pyx_b;
static int __pyx_lineno;
static char *__pyx_filename;
static char **__pyx_f;

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/

static int __Pyx_PrintItem(PyObject *); /*proto*/
static int __Pyx_PrintNewline(void); /*proto*/

static void __Pyx_WriteUnraisable(char *name); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static int __Pyx_InternStrings(__Pyx_InternTabEntry *t); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/

static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name, long size);  /*proto*/

static void __Pyx_AddTraceback(char *funcname); /*proto*/

/* Declarations from c_python */


/* Declarations from c_numpy */

static PyTypeObject *__pyx_ptype_7c_numpy_dtype = 0;
static PyTypeObject *__pyx_ptype_7c_numpy_ndarray = 0;
static PyTypeObject *__pyx_ptype_7c_numpy_flatiter = 0;

/* Declarations from simutils */

struct __pyx_t_8simutils_Connection_Group_struct {
  int output_num;
  int input_num;
  double (*weights);
  double sign;
  double dt;
  char (*outspike);
  char (*inspike);
  char (*old_outspike);
  char (*old_inspike);
  double (*in_V);
  double (*out_V);
  int type;
  double (*weight_saturation);
  double (*x);
  double (*xtmp);
  double (*y);
  double (*ytmp);
  double (*th);
  double (*beta);
  int use_beta;
  double tau_beta;
  double activation_magnitude;
  double tau_activation;
  double tau_thresh;
  double thresh_o;
  double xo;
  double yo;
  double eta;
  double lambda_decay;
  int learning_rule;
  double (*v_backspike_slow);
  double (*v_backspike_fast);
  double (*v_total);
  double (*g_nmda);
  double (*I_nmda);
  double (*I_nmda_slow);
  double (*I_nmda_fast);
  double (*Ca);
  double peak_backspike_slow;
  double peak_backspike_fast;
  double backspike_amplitude;
  double k_minus;
  double k_plus;
  double g_t;
  double Vo;
  double Vp;
  double i_nmda_mu;
  double i_nmda_s;
  double i_nmda_f;
  double tau_nmda_s;
  double tau_nmda_f;
  double mg1;
  double mg2;
  double tau_ca;
  double omega_offset;
  double alpha1;
  double alpha2;
  double beta1;
  double beta2;
  double theta_o;
  double omega_max;
  double eta_down;
  double eta_up;
  double eta_p1;
  double eta_p2;
  double eta_p3;
  double eta_p4;
  double eta_gamma0;
  double tau_backspike_fast;
  double tau_backspike_slow;
  double tau_minus;
  double tau_plus;
  double a_minus;
  double a_plus;
  double g_max;
  int nearest_neighbor;
  double (*M);
  double (*P);
  double tau_x;
  double tau_y;
  double A2_minus;
  double A2_plus;
  double A3_minus;
  double A3_plus;
  double (*r1);
  double (*r2);
  double (*o1);
  double (*o2);
};

struct __pyx_t_8simutils_Neuron_Group_struct {
  int quantity;
  double dt;
  char (*spike);
  char (*old_spike);
  int number_of_connection_groups_to;
  int type;
  double (save_spike_range[2]);
  char (*(c_old_spike[31]));
  int (c_num_incell[31]);
  int (c_num_outcell[31]);
  int (c_sign[31]);
  double (*(c_g[31]));
  double (*(c_weights[31]));
  double (*V);
  double (*time_to_next_spike);
  double min_latency;
  double max_latency;
  double time_between_rates;
  double time_to_next_rate;
  double (*rate);
  int number_of_rates;
  int sequential;
  int which_rate;
  double (*time_to_stop_refract);
  double (*V_reset);
  double tau_m;
  double tau_ex;
  double tau_in;
  double reset_adaptation;
  double t_refract;
  double V_rev_exc;
  double V_rev_inh;
  double V_thresh;
  double g_exc_max;
  double g_inh_max;
  double (*y);
  double activation_magnitude;
  double tau_activation;
  double time_to_next_pattern;
  double time_for_last_pattern;
  int (*pattern_count);
  int (*pattern_length);
  double rate_val;
  double (*u);
  double (*epsp1);
  double (*epsp2);
  double (*ipsp1);
  double (*ipsp2);
  double a;
  double b;
  double c;
  double d;
  double I;
  double V_peak;
  double tau_epsp1;
  double tau_epsp2;
  double epsp_scale;
};

static double (*(__pyx_f_8simutils_DoubleData(PyArrayObject *))); /*proto*/
static char (*(__pyx_f_8simutils_CharData(PyArrayObject *))); /*proto*/
static int (*(__pyx_f_8simutils_IntData(PyArrayObject *))); /*proto*/
static int (__pyx_f_8simutils_Dim0(PyArrayObject *)); /*proto*/
static int (__pyx_f_8simutils_Dim1(PyArrayObject *)); /*proto*/
static PyObject *(__pyx_f_8simutils_saturate(struct __pyx_t_8simutils_Connection_Group_struct (*))); /*proto*/
static double (__pyx_f_8simutils_sig(double ,double )); /*proto*/
static struct __pyx_t_8simutils_Connection_Group_struct (__pyx_f_8simutils_init_Connection_Group(PyObject *)); /*proto*/
static PyObject *(__pyx_f_8simutils_Constant_Connection_update(struct __pyx_t_8simutils_Connection_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Spiking_Rate_update(struct __pyx_t_8simutils_Connection_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Calcium_update(struct __pyx_t_8simutils_Connection_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_STDP_update(struct __pyx_t_8simutils_Connection_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Gerstner06_update(struct __pyx_t_8simutils_Connection_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_cupdate(struct __pyx_t_8simutils_Connection_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_copy_spikes(struct __pyx_t_8simutils_Neuron_Group_struct (*))); /*proto*/
static struct __pyx_t_8simutils_Neuron_Group_struct (__pyx_f_8simutils_init_Neuron_Group(PyObject *)); /*proto*/
static PyObject *(__pyx_f_8simutils_save_spikes(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Silent_Neuron_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Constant_Fixed_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Constant_Poisson_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Variable_Poisson_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Integrate_and_Fire_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Stochastic_Rate_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Spike_Pattern_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_Izh_update(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/
static PyObject *(__pyx_f_8simutils_nupdate(struct __pyx_t_8simutils_Neuron_Group_struct (*),PyObject *,double )); /*proto*/


/* Implementation of simutils */


static PyObject *__pyx_n_c_python;
static PyObject *__pyx_n_c_numpy;
static PyObject *__pyx_n_sys;
static PyObject *__pyx_n_time;
static PyObject *__pyx_n_Waitbar;
static PyObject *__pyx_n_sim;
static PyObject *__pyx_n_run_sim;
static PyObject *__pyx_n_run_sim_working;

static double (*__pyx_f_8simutils_DoubleData(PyArrayObject *__pyx_v_M)) {
  double (*__pyx_r);
  Py_INCREF(__pyx_v_M);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":12 */
  __pyx_r = ((double (*))__pyx_v_M->data);
  goto __pyx_L0;

  __pyx_L0:;
  Py_DECREF(__pyx_v_M);
  return __pyx_r;
}

static char (*__pyx_f_8simutils_CharData(PyArrayObject *__pyx_v_M)) {
  char (*__pyx_r);
  Py_INCREF(__pyx_v_M);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":15 */
  __pyx_r = ((char (*))__pyx_v_M->data);
  goto __pyx_L0;

  __pyx_L0:;
  Py_DECREF(__pyx_v_M);
  return __pyx_r;
}

static int (*__pyx_f_8simutils_IntData(PyArrayObject *__pyx_v_M)) {
  int (*__pyx_r);
  Py_INCREF(__pyx_v_M);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":18 */
  __pyx_r = ((int (*))__pyx_v_M->data);
  goto __pyx_L0;

  __pyx_L0:;
  Py_DECREF(__pyx_v_M);
  return __pyx_r;
}

static int __pyx_f_8simutils_Dim0(PyArrayObject *__pyx_v_M) {
  int __pyx_r;
  Py_INCREF(__pyx_v_M);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":22 */
  __pyx_r = (__pyx_v_M->dimensions[0]);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_M);
  return __pyx_r;
}

static int __pyx_f_8simutils_Dim1(PyArrayObject *__pyx_v_M) {
  int __pyx_r;
  Py_INCREF(__pyx_v_M);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":25 */
  __pyx_r = (__pyx_v_M->dimensions[1]);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_M);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_saturate(struct __pyx_t_8simutils_Connection_Group_struct (*__pyx_v_s)) {
  int __pyx_v_output_num;
  int __pyx_v_input_num;
  int __pyx_v_count;
  int __pyx_v_o;
  int __pyx_v_i;
  double (*__pyx_v_weights);
  double (*__pyx_v_weight_saturation);
  PyObject *__pyx_r;
  int __pyx_1;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":61 */
  __pyx_v_weights = __pyx_v_s->weights;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":62 */
  __pyx_v_output_num = __pyx_v_s->output_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":63 */
  __pyx_v_input_num = __pyx_v_s->input_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":64 */
  __pyx_v_weight_saturation = __pyx_v_s->weight_saturation;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":66 */
  __pyx_v_count = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":67 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":68 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":70 */
      __pyx_1 = ((__pyx_v_weights[__pyx_v_count]) < (__pyx_v_weight_saturation[0]));
      if (__pyx_1) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":71 */
        (__pyx_v_weights[__pyx_v_count]) = (__pyx_v_weight_saturation[0]);
        goto __pyx_L6;
      }
      __pyx_L6:;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":73 */
      __pyx_1 = ((__pyx_v_weights[__pyx_v_count]) > (__pyx_v_weight_saturation[1]));
      if (__pyx_1) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":74 */
        (__pyx_v_weights[__pyx_v_count]) = (__pyx_v_weight_saturation[1]);
        goto __pyx_L7;
      }
      __pyx_L7:;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":76 */
      __pyx_v_count = (__pyx_v_count + 1);
    }
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  return __pyx_r;
}

static double __pyx_f_8simutils_sig(double __pyx_v_x,double __pyx_v_beta) {
  double __pyx_r;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":82 */
  __pyx_r = ((tanh(((__pyx_v_beta * __pyx_v_x) / 2.0)) + 1.0) / 2.0);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

static PyObject *__pyx_n_sign;
static PyObject *__pyx_n_dt;
static PyObject *__pyx_n_weights;
static PyObject *__pyx_n_outcell;
static PyObject *__pyx_n_spike;
static PyObject *__pyx_n_incell;
static PyObject *__pyx_n_V;
static PyObject *__pyx_n_old_spike;
static PyObject *__pyx_n_weight_saturation;
static PyObject *__pyx_n___module__;
static PyObject *__pyx_n_activation_magnitude;
static PyObject *__pyx_n_tau_activation;
static PyObject *__pyx_n_tau_thresh;
static PyObject *__pyx_n_thresh_o;
static PyObject *__pyx_n_learning_rule;
static PyObject *__pyx_n_xo;
static PyObject *__pyx_n_yo;
static PyObject *__pyx_n_eta;
static PyObject *__pyx_n_use_beta;
static PyObject *__pyx_n_tau_beta;
static PyObject *__pyx_n_lambda_decay;
static PyObject *__pyx_n_x;
static PyObject *__pyx_n_xtmp;
static PyObject *__pyx_n_y;
static PyObject *__pyx_n_ytmp;
static PyObject *__pyx_n_th;
static PyObject *__pyx_n_beta;
static PyObject *__pyx_n_v_backspike_slow;
static PyObject *__pyx_n_v_backspike_fast;
static PyObject *__pyx_n_v_total;
static PyObject *__pyx_n_g_nmda;
static PyObject *__pyx_n_I_nmda;
static PyObject *__pyx_n_I_nmda_slow;
static PyObject *__pyx_n_I_nmda_fast;
static PyObject *__pyx_n_Ca;
static PyObject *__pyx_n_peak_backspike_slow;
static PyObject *__pyx_n_peak_backspike_fast;
static PyObject *__pyx_n_backspike_amplitude;
static PyObject *__pyx_n_k_minus;
static PyObject *__pyx_n_k_plus;
static PyObject *__pyx_n_g_t;
static PyObject *__pyx_n_Vo;
static PyObject *__pyx_n_Vp;
static PyObject *__pyx_n_i_nmda_mu;
static PyObject *__pyx_n_i_nmda_s;
static PyObject *__pyx_n_i_nmda_f;
static PyObject *__pyx_n_tau_nmda_s;
static PyObject *__pyx_n_tau_nmda_f;
static PyObject *__pyx_n_mg1;
static PyObject *__pyx_n_mg2;
static PyObject *__pyx_n_tau_ca;
static PyObject *__pyx_n_omega_offset;
static PyObject *__pyx_n_alpha1;
static PyObject *__pyx_n_alpha2;
static PyObject *__pyx_n_beta1;
static PyObject *__pyx_n_beta2;
static PyObject *__pyx_n_theta_o;
static PyObject *__pyx_n_omega_max;
static PyObject *__pyx_n_eta_down;
static PyObject *__pyx_n_eta_up;
static PyObject *__pyx_n_eta_p1;
static PyObject *__pyx_n_eta_p2;
static PyObject *__pyx_n_eta_p3;
static PyObject *__pyx_n_eta_p4;
static PyObject *__pyx_n_eta_gamma0;
static PyObject *__pyx_n_tau_backspike_fast;
static PyObject *__pyx_n_tau_backspike_slow;
static PyObject *__pyx_n_tau_minus;
static PyObject *__pyx_n_tau_plus;
static PyObject *__pyx_n_a_minus;
static PyObject *__pyx_n_a_plus;
static PyObject *__pyx_n_g_max;
static PyObject *__pyx_n_nearest_neighbor;
static PyObject *__pyx_n_M;
static PyObject *__pyx_n_P;
static PyObject *__pyx_n_tau_x;
static PyObject *__pyx_n_tau_y;
static PyObject *__pyx_n_A2_minus;
static PyObject *__pyx_n_A2_plus;
static PyObject *__pyx_n_A3_minus;
static PyObject *__pyx_n_A3_plus;
static PyObject *__pyx_n_R1;
static PyObject *__pyx_n_R2;
static PyObject *__pyx_n_O1;
static PyObject *__pyx_n_O2;

static PyObject *__pyx_k6p;
static PyObject *__pyx_k7p;
static PyObject *__pyx_k8p;
static PyObject *__pyx_k9p;
static PyObject *__pyx_k10p;
static PyObject *__pyx_k11p;

static char (__pyx_k6[]) = "splikes.connection_groups.Constant_Connection";
static char (__pyx_k7[]) = "splikes.connection_groups.Spiking_Rate";
static char (__pyx_k8[]) = "splikes.connection_groups.Calcium";
static char (__pyx_k9[]) = "splikes.connection_groups.STDP";
static char (__pyx_k10[]) = "splikes.connection_groups.Gerstner06";
static char (__pyx_k11[]) = "Unimplemented Connection_Group Update";

static struct __pyx_t_8simutils_Connection_Group_struct __pyx_f_8simutils_init_Connection_Group(PyObject *__pyx_v_self) {
  struct __pyx_t_8simutils_Connection_Group_struct __pyx_v_s;
  struct __pyx_t_8simutils_Connection_Group_struct __pyx_r;
  PyObject *__pyx_1 = 0;
  double __pyx_2;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":93 */
  __pyx_v_s.type = (-1);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":94 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_sign); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; goto __pyx_L1;}
  __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_s.sign = __pyx_2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":95 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_dt); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; goto __pyx_L1;}
  __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_s.dt = __pyx_2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":96 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_weights); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; goto __pyx_L1;}
  __pyx_v_s.weights = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":97 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_outcell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_spike); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; goto __pyx_L1;}
  __pyx_v_s.outspike = __pyx_f_8simutils_CharData(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":98 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_incell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_spike); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; goto __pyx_L1;}
  __pyx_v_s.inspike = __pyx_f_8simutils_CharData(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":100 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_incell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_V); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; goto __pyx_L1;}
  __pyx_v_s.in_V = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":101 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_outcell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_V); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; goto __pyx_L1;}
  __pyx_v_s.out_V = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":102 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_outcell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_old_spike); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; goto __pyx_L1;}
  __pyx_v_s.old_outspike = __pyx_f_8simutils_CharData(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":103 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_incell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_old_spike); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; goto __pyx_L1;}
  __pyx_v_s.old_inspike = __pyx_f_8simutils_CharData(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":104 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_outcell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_spike); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; goto __pyx_L1;}
  __pyx_v_s.output_num = __pyx_f_8simutils_Dim0(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":105 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_incell); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; goto __pyx_L1;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n_spike); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; goto __pyx_L1;}
  __pyx_v_s.input_num = __pyx_f_8simutils_Dim0(((PyArrayObject *)__pyx_3));
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":106 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_weight_saturation); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; goto __pyx_L1;}
  __pyx_v_s.weight_saturation = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":108 */
  __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_3, __pyx_k6p, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":109 */
    __pyx_v_s.type = 0;
    goto __pyx_L2;
  }
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_1, __pyx_k7p, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":111 */
    __pyx_v_s.type = 1;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":113 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_activation_magnitude); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.activation_magnitude = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":114 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_activation); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_activation = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":115 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_thresh); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.tau_thresh = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":116 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_thresh_o); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.thresh_o = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":117 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_learning_rule); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; goto __pyx_L1;}
    __pyx_4 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.learning_rule = __pyx_4;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":118 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_xo); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.xo = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":119 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_yo); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.yo = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":120 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.eta = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":121 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_use_beta); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; goto __pyx_L1;}
    __pyx_4 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.use_beta = __pyx_4;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":122 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_beta); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_beta = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":123 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_lambda_decay); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.lambda_decay = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":125 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_x); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; goto __pyx_L1;}
    __pyx_v_s.x = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":126 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_xtmp); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; goto __pyx_L1;}
    __pyx_v_s.xtmp = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":127 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_y); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; goto __pyx_L1;}
    __pyx_v_s.y = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":128 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_ytmp); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; goto __pyx_L1;}
    __pyx_v_s.ytmp = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":129 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_th); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; goto __pyx_L1;}
    __pyx_v_s.th = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":130 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_beta); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; goto __pyx_L1;}
    __pyx_v_s.beta = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_1, __pyx_k8p, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":133 */
    __pyx_v_s.type = 2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":135 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_v_backspike_slow); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; goto __pyx_L1;}
    __pyx_v_s.v_backspike_slow = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":136 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_v_backspike_fast); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; goto __pyx_L1;}
    __pyx_v_s.v_backspike_fast = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":137 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_v_total); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; goto __pyx_L1;}
    __pyx_v_s.v_total = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":139 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_g_nmda); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; goto __pyx_L1;}
    __pyx_v_s.g_nmda = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":140 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_I_nmda); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; goto __pyx_L1;}
    __pyx_v_s.I_nmda = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":141 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_I_nmda_slow); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; goto __pyx_L1;}
    __pyx_v_s.I_nmda_slow = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":142 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_I_nmda_fast); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; goto __pyx_L1;}
    __pyx_v_s.I_nmda_fast = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":143 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_Ca); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; goto __pyx_L1;}
    __pyx_v_s.Ca = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":146 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_peak_backspike_slow); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.peak_backspike_slow = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":147 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_peak_backspike_fast); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.peak_backspike_fast = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":148 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_backspike_amplitude); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.backspike_amplitude = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":149 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_k_minus); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.k_minus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":150 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_k_plus); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.k_plus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":151 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_g_t); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.g_t = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":152 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_Vo); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.Vo = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":153 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_Vp); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.Vp = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":154 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_i_nmda_mu); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.i_nmda_mu = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":155 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_i_nmda_s); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.i_nmda_s = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":156 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_i_nmda_f); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.i_nmda_f = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":157 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_nmda_s); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_nmda_s = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":158 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_nmda_f); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.tau_nmda_f = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":159 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_mg1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.mg1 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":160 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_mg2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.mg2 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":161 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_g_t); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.g_t = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":162 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_ca); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.tau_ca = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":163 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_learning_rule); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; goto __pyx_L1;}
    __pyx_4 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.learning_rule = __pyx_4;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":164 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_omega_offset); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.omega_offset = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":165 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_alpha1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.alpha1 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":166 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_alpha2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.alpha2 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":167 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_beta1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.beta1 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":168 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_beta2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.beta2 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":169 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_theta_o); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.theta_o = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":170 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_omega_max); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.omega_max = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":171 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta_down); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.eta_down = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":172 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta_up); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.eta_up = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":173 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta_p1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.eta_p1 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":174 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta_p2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.eta_p2 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":175 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta_p3); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.eta_p3 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":176 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta_p4); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.eta_p4 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":177 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_eta_gamma0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.eta_gamma0 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":178 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_lambda_decay); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.lambda_decay = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":179 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_backspike_fast); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_backspike_fast = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":180 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_backspike_slow); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.tau_backspike_slow = __pyx_2;
    goto __pyx_L2;
  }
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_1, __pyx_k9p, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":183 */
    __pyx_v_s.type = 3;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":184 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_minus); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.tau_minus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":185 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_plus); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_plus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":186 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_a_minus); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.a_minus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":187 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_a_plus); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.a_plus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":188 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_g_max); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.g_max = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":189 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_nearest_neighbor); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; goto __pyx_L1;}
    __pyx_4 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.nearest_neighbor = __pyx_4;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":190 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_M); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; goto __pyx_L1;}
    __pyx_v_s.M = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":191 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_P); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; goto __pyx_L1;}
    __pyx_v_s.P = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    goto __pyx_L2;
  }
  __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_3, __pyx_k10p, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; goto __pyx_L1;}
  __pyx_4 = __pyx_4 == 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":194 */
    __pyx_v_s.type = 4;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":196 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_minus); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_minus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":197 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_plus); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.tau_plus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":198 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_x); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_x = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":199 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_y); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.tau_y = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":200 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_A2_minus); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.A2_minus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":201 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_A2_plus); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.A2_plus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":202 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_A3_minus); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.A3_minus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":203 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_A3_plus); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s.A3_plus = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":204 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_nearest_neighbor); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; goto __pyx_L1;}
    __pyx_4 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.nearest_neighbor = __pyx_4;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":206 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_R1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; goto __pyx_L1;}
    __pyx_v_s.r1 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":207 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_R2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; goto __pyx_L1;}
    __pyx_v_s.r2 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":208 */
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_O1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; goto __pyx_L1;}
    __pyx_v_s.o1 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":209 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_O2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; goto __pyx_L1;}
    __pyx_v_s.o2 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":211 */
    if (__Pyx_PrintItem(__pyx_k11p) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; goto __pyx_L1;}
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; goto __pyx_L1;}
    if (__Pyx_PrintItem(__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    if (__Pyx_PrintNewline() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; goto __pyx_L1;}
  }
  __pyx_L2:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":213 */
  __pyx_r = __pyx_v_s;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  __Pyx_WriteUnraisable("simutils.init_Connection_Group");
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Constant_Connection_update(struct __pyx_t_8simutils_Connection_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":217 */

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Spiking_Rate_update(struct __pyx_t_8simutils_Connection_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_output_num;
  int __pyx_v_input_num;
  double (*__pyx_v_weights);
  double (*__pyx_v_x);
  double (*__pyx_v_xtmp);
  double (*__pyx_v_y);
  double (*__pyx_v_ytmp);
  double (*__pyx_v_th);
  double (*__pyx_v_beta);
  char (*__pyx_v_outspike);
  char (*__pyx_v_inspike);
  double __pyx_v_activation_magnitude;
  double __pyx_v_sign;
  double __pyx_v_dt;
  double __pyx_v_tau_activation;
  double __pyx_v_tau_thresh;
  double __pyx_v_thresh_o;
  double __pyx_v_xo;
  double __pyx_v_yo;
  double __pyx_v_eta;
  double __pyx_v_lambda_decay;
  double __pyx_v_tau_beta;
  int __pyx_v_learning_rule;
  int __pyx_v_use_beta;
  double __pyx_v_tmp_y;
  int __pyx_v_o;
  int __pyx_v_i;
  PyObject *__pyx_v_count;
  PyObject *__pyx_r;
  char __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  int __pyx_5;
  int __pyx_6;
  PyObject *__pyx_7 = 0;
  Py_INCREF(__pyx_v_self);
  __pyx_v_count = Py_None; Py_INCREF(Py_None);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":230 */
  __pyx_v_activation_magnitude = __pyx_v_s->activation_magnitude;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":231 */
  __pyx_v_sign = __pyx_v_s->sign;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":232 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":233 */
  __pyx_v_tau_activation = __pyx_v_s->tau_activation;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":234 */
  __pyx_v_tau_thresh = __pyx_v_s->tau_thresh;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":235 */
  __pyx_v_thresh_o = __pyx_v_s->thresh_o;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":236 */
  __pyx_v_learning_rule = __pyx_v_s->learning_rule;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":237 */
  __pyx_v_xo = __pyx_v_s->xo;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":238 */
  __pyx_v_yo = __pyx_v_s->yo;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":239 */
  __pyx_v_eta = __pyx_v_s->eta;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":240 */
  __pyx_v_lambda_decay = __pyx_v_s->lambda_decay;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":241 */
  __pyx_v_tau_beta = __pyx_v_s->tau_beta;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":242 */
  __pyx_v_use_beta = __pyx_v_s->use_beta;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":245 */
  __pyx_v_x = __pyx_v_s->x;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":246 */
  __pyx_v_xtmp = __pyx_v_s->xtmp;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":247 */
  __pyx_v_y = __pyx_v_s->y;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":248 */
  __pyx_v_ytmp = __pyx_v_s->ytmp;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":249 */
  __pyx_v_th = __pyx_v_s->th;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":250 */
  __pyx_v_beta = __pyx_v_s->beta;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":252 */
  __pyx_v_weights = __pyx_v_s->weights;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":253 */
  __pyx_v_outspike = __pyx_v_s->outspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":254 */
  __pyx_v_inspike = __pyx_v_s->inspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":255 */
  __pyx_v_output_num = __pyx_v_s->output_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":256 */
  __pyx_v_input_num = __pyx_v_s->input_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":260 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":261 */
    __pyx_1 = (__pyx_v_inspike[__pyx_v_i]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":262 */
      (__pyx_v_xtmp[__pyx_v_i]) = ((__pyx_v_xtmp[__pyx_v_i]) + (__pyx_v_activation_magnitude * __pyx_v_sign));
      goto __pyx_L4;
    }
    __pyx_L4:;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":263 */
    (__pyx_v_x[__pyx_v_i]) = ((__pyx_v_x[__pyx_v_i]) + (((1.0 / __pyx_v_tau_activation) * ((__pyx_v_xtmp[__pyx_v_i]) - (__pyx_v_x[__pyx_v_i]))) * __pyx_v_dt));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":264 */
    (__pyx_v_xtmp[__pyx_v_i]) = ((__pyx_v_xtmp[__pyx_v_i]) - (((1.0 / __pyx_v_tau_activation) * (__pyx_v_xtmp[__pyx_v_i])) * __pyx_v_dt));
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":267 */
  for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":268 */
    __pyx_1 = (__pyx_v_outspike[__pyx_v_o]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":269 */
      (__pyx_v_ytmp[__pyx_v_o]) = ((__pyx_v_ytmp[__pyx_v_o]) + __pyx_v_activation_magnitude);
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":270 */
    (__pyx_v_y[__pyx_v_o]) = ((__pyx_v_y[__pyx_v_o]) + (((1.0 / __pyx_v_tau_activation) * ((__pyx_v_ytmp[__pyx_v_o]) - (__pyx_v_y[__pyx_v_o]))) * __pyx_v_dt));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":271 */
    (__pyx_v_ytmp[__pyx_v_o]) = ((__pyx_v_ytmp[__pyx_v_o]) - (((1.0 / __pyx_v_tau_activation) * (__pyx_v_ytmp[__pyx_v_o])) * __pyx_v_dt));
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":273 */
  __pyx_2 = __pyx_v_use_beta;
  if (__pyx_2) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":274 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":275 */
      (__pyx_v_beta[__pyx_v_o]) = ((__pyx_v_beta[__pyx_v_o]) + (((1.0 / __pyx_v_tau_beta) * ((__pyx_v_y[__pyx_v_o]) - (__pyx_v_beta[__pyx_v_o]))) * __pyx_v_dt));
    }
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":279 */
  __pyx_2 = __pyx_v_use_beta;
  if (__pyx_2) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":280 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":281 */
      __pyx_v_tmp_y = ((__pyx_v_y[__pyx_v_o]) - (__pyx_v_beta[__pyx_v_o]));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":282 */
      __pyx_2 = (__pyx_v_tmp_y < 0.0);
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":283 */
        __pyx_v_tmp_y = 0.0;
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":284 */
      (__pyx_v_th[__pyx_v_o]) = ((__pyx_v_th[__pyx_v_o]) + ((1.0 / __pyx_v_tau_thresh) * ((((__pyx_v_tmp_y - __pyx_v_yo) * (__pyx_v_tmp_y - __pyx_v_yo)) / __pyx_v_thresh_o) - __pyx_v_tmp_y)));
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":286 */
    __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; goto __pyx_L1;}
    Py_DECREF(__pyx_v_count);
    __pyx_v_count = __pyx_3;
    __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":287 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":288 */
      for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":290 */
        __pyx_v_tmp_y = ((__pyx_v_y[__pyx_v_o]) - (__pyx_v_beta[__pyx_v_o]));

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":291 */
        __pyx_2 = (__pyx_v_tmp_y < 0.0);
        if (__pyx_2) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":292 */
          __pyx_v_tmp_y = 0.0;
          goto __pyx_L19;
        }
        __pyx_L19:;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":295 */
        __pyx_2 = (__pyx_v_learning_rule == 1);
        if (__pyx_2) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":296 */
          __pyx_2 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; goto __pyx_L1;}
          __pyx_4 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; goto __pyx_L1;}
          __pyx_5 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; goto __pyx_L1;}
          (__pyx_v_weights[__pyx_5]) = ((__pyx_v_weights[__pyx_2]) + (__pyx_v_eta * (((((__pyx_v_x[__pyx_v_i]) - __pyx_v_xo) * (__pyx_v_tmp_y - __pyx_v_yo)) * ((__pyx_v_tmp_y - __pyx_v_yo) - (__pyx_v_th[__pyx_v_o]))) - (__pyx_v_lambda_decay * (__pyx_v_weights[__pyx_4])))));
          goto __pyx_L20;
        }
        __pyx_2 = (__pyx_v_learning_rule == 2);
        if (__pyx_2) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":298 */
          __pyx_4 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; goto __pyx_L1;}
          __pyx_5 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; goto __pyx_L1;}
          __pyx_2 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; goto __pyx_L1;}
          (__pyx_v_weights[__pyx_2]) = ((__pyx_v_weights[__pyx_4]) + (__pyx_v_eta * ((((((__pyx_v_x[__pyx_v_i]) - __pyx_v_xo) * (__pyx_v_tmp_y - __pyx_v_yo)) * ((__pyx_v_tmp_y - __pyx_v_yo) - (__pyx_v_th[__pyx_v_o]))) / (__pyx_v_th[__pyx_v_o])) - (__pyx_v_lambda_decay * (__pyx_v_weights[__pyx_5])))));
          goto __pyx_L20;
        }
        __pyx_4 = (__pyx_v_learning_rule == 3);
        if (__pyx_4) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":300 */
          __pyx_5 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; goto __pyx_L1;}
          __pyx_2 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; goto __pyx_L1;}
          __pyx_4 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; goto __pyx_L1;}
          __pyx_6 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; goto __pyx_L1;}
          (__pyx_v_weights[__pyx_6]) = ((__pyx_v_weights[__pyx_5]) + (__pyx_v_eta * (((((__pyx_v_x[__pyx_v_i]) - __pyx_v_xo) * (__pyx_v_tmp_y - __pyx_v_yo)) - (((__pyx_v_tmp_y - __pyx_v_yo) * (__pyx_v_tmp_y - __pyx_v_yo)) * (__pyx_v_weights[__pyx_2]))) - (__pyx_v_lambda_decay * (__pyx_v_weights[__pyx_4])))));
          goto __pyx_L20;
        }
        __pyx_L20:;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":302 */
        __pyx_3 = PyInt_FromLong(1); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 302; goto __pyx_L1;}
        __pyx_7 = PyNumber_Add(__pyx_v_count, __pyx_3); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 302; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_v_count);
        __pyx_v_count = __pyx_7;
        __pyx_7 = 0;
      }
    }
    goto __pyx_L11;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":305 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":306 */
      (__pyx_v_th[__pyx_v_o]) = ((__pyx_v_th[__pyx_v_o]) + ((1.0 / __pyx_v_tau_thresh) * (((((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo) * ((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo)) / __pyx_v_thresh_o) - (__pyx_v_th[__pyx_v_o]))));
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":308 */
    __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 308; goto __pyx_L1;}
    Py_DECREF(__pyx_v_count);
    __pyx_v_count = __pyx_3;
    __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":309 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":310 */
      for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":313 */
        __pyx_5 = (__pyx_v_learning_rule == 1);
        if (__pyx_5) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":314 */
          __pyx_2 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; goto __pyx_L1;}
          __pyx_4 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; goto __pyx_L1;}
          __pyx_6 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; goto __pyx_L1;}
          (__pyx_v_weights[__pyx_6]) = ((__pyx_v_weights[__pyx_2]) + (__pyx_v_eta * (((((__pyx_v_x[__pyx_v_i]) - __pyx_v_xo) * ((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo)) * (((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo) - (__pyx_v_th[__pyx_v_o]))) - (__pyx_v_lambda_decay * (__pyx_v_weights[__pyx_4])))));
          goto __pyx_L27;
        }
        __pyx_5 = (__pyx_v_learning_rule == 2);
        if (__pyx_5) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":316 */
          __pyx_2 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; goto __pyx_L1;}
          __pyx_4 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; goto __pyx_L1;}
          __pyx_6 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; goto __pyx_L1;}
          (__pyx_v_weights[__pyx_6]) = ((__pyx_v_weights[__pyx_2]) + (__pyx_v_eta * ((((((__pyx_v_x[__pyx_v_i]) - __pyx_v_xo) * ((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo)) * (((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo) - (__pyx_v_th[__pyx_v_o]))) / (__pyx_v_th[__pyx_v_o])) - (__pyx_v_lambda_decay * (__pyx_v_weights[__pyx_4])))));
          goto __pyx_L27;
        }
        __pyx_5 = (__pyx_v_learning_rule == 3);
        if (__pyx_5) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":318 */
          __pyx_2 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; goto __pyx_L1;}
          __pyx_4 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; goto __pyx_L1;}
          __pyx_6 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; goto __pyx_L1;}
          __pyx_5 = PyInt_AsLong(__pyx_v_count); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; goto __pyx_L1;}
          (__pyx_v_weights[__pyx_5]) = ((__pyx_v_weights[__pyx_2]) + (__pyx_v_eta * (((((__pyx_v_x[__pyx_v_i]) - __pyx_v_xo) * ((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo)) - ((((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo) * ((__pyx_v_y[__pyx_v_o]) - __pyx_v_yo)) * (__pyx_v_weights[__pyx_4]))) - (__pyx_v_lambda_decay * (__pyx_v_weights[__pyx_6])))));
          goto __pyx_L27;
        }
        __pyx_L27:;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":320 */
        __pyx_7 = PyInt_FromLong(1); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; goto __pyx_L1;}
        __pyx_3 = PyNumber_Add(__pyx_v_count, __pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; goto __pyx_L1;}
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_v_count);
        __pyx_v_count = __pyx_3;
        __pyx_3 = 0;
      }
    }
  }
  __pyx_L11:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("simutils.Spiking_Rate_update");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_count);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_n_v_reversal;
static PyObject *__pyx_n_pow;
static PyObject *__pyx_n_ValueError;

static PyObject *__pyx_k12p;

static char (__pyx_k12[]) = "Unknown Learning Rule";

static PyObject *__pyx_f_8simutils_Calcium_update(struct __pyx_t_8simutils_Connection_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  double (*__pyx_v_v_backspike_slow);
  double (*__pyx_v_v_backspike_fast);
  double (*__pyx_v_v_total);
  double __pyx_v_B;
  double __pyx_v_h;
  double __pyx_v_eta;
  double __pyx_v_omega;
  double (*__pyx_v_g_nmda);
  double (*__pyx_v_I_nmda);
  double (*__pyx_v_I_nmda_slow);
  double (*__pyx_v_I_nmda_fast);
  double (*__pyx_v_Ca);
  int __pyx_v_output_num;
  int __pyx_v_input_num;
  double (*__pyx_v_weights);
  char (*__pyx_v_outspike);
  char (*__pyx_v_inspike);
  int __pyx_v_o;
  int __pyx_v_i;
  int __pyx_v_c;
  double (*__pyx_v_V);
  PyObject *__pyx_r;
  char __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  double __pyx_7;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  PyObject *__pyx_11 = 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":333 */
  __pyx_v_v_backspike_slow = __pyx_v_s->v_backspike_slow;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":334 */
  __pyx_v_v_backspike_fast = __pyx_v_s->v_backspike_fast;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":335 */
  __pyx_v_v_total = __pyx_v_s->v_total;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":336 */
  __pyx_v_g_nmda = __pyx_v_s->g_nmda;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":337 */
  __pyx_v_I_nmda = __pyx_v_s->I_nmda;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":338 */
  __pyx_v_I_nmda_slow = __pyx_v_s->I_nmda_slow;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":339 */
  __pyx_v_I_nmda_fast = __pyx_v_s->I_nmda_fast;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":340 */
  __pyx_v_Ca = __pyx_v_s->Ca;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":347 */
  __pyx_v_weights = __pyx_v_s->weights;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":348 */
  __pyx_v_outspike = __pyx_v_s->outspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":349 */
  __pyx_v_inspike = __pyx_v_s->inspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":350 */
  __pyx_v_output_num = __pyx_v_s->output_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":351 */
  __pyx_v_input_num = __pyx_v_s->input_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":377 */
  for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":378 */
    __pyx_1 = (__pyx_v_outspike[__pyx_v_o]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":379 */
      (__pyx_v_v_backspike_slow[__pyx_v_o]) = __pyx_v_s->peak_backspike_slow;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":380 */
      (__pyx_v_v_backspike_fast[__pyx_v_o]) = __pyx_v_s->peak_backspike_fast;
      goto __pyx_L4;
    }
    __pyx_L4:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":383 */
  __pyx_v_c = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":384 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":385 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":386 */
      (__pyx_v_v_total[__pyx_v_c]) = 0.0;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":387 */
      __pyx_v_c = (__pyx_v_c + 1);
    }
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":391 */
  __pyx_v_V = __pyx_v_s->out_V;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":393 */
  __pyx_v_c = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":394 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":395 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":396 */
      (__pyx_v_v_total[__pyx_v_c]) = ((__pyx_v_v_total[__pyx_v_c]) + (__pyx_v_V[__pyx_v_o]));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":397 */
      (__pyx_v_v_total[__pyx_v_c]) = ((__pyx_v_v_total[__pyx_v_c]) + (__pyx_v_s->backspike_amplitude * ((__pyx_v_v_backspike_fast[__pyx_v_o]) + (__pyx_v_v_backspike_slow[__pyx_v_o]))));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":400 */
      __pyx_v_c = (__pyx_v_c + 1);
    }
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":406 */
  __pyx_2 = (__pyx_v_s->k_minus != 0);
  if (!__pyx_2) {
    __pyx_2 = (__pyx_v_s->k_plus != 0);
  }
  if (__pyx_2) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":413 */
    __pyx_v_c = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":414 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":415 */
      for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":417 */
        (__pyx_v_g_nmda[__pyx_v_c]) = ((__pyx_v_g_nmda[__pyx_v_c]) + (__pyx_v_s->dt * ((__pyx_v_s->k_plus * __pyx_v_s->g_t) - ((__pyx_v_s->k_plus + (__pyx_v_s->k_minus * pow(((__pyx_v_v_total[__pyx_v_c]) - __pyx_v_s->Vo), __pyx_v_s->Vp))) * (__pyx_v_g_nmda[__pyx_v_c])))));

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":419 */
        __pyx_v_c = (__pyx_v_c + 1);
      }
    }
    goto __pyx_L13;
  }
  __pyx_L13:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":424 */
  __pyx_v_c = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":425 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":427 */
    __pyx_1 = (__pyx_v_inspike[__pyx_v_i]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":428 */
      (__pyx_v_I_nmda_slow[__pyx_v_i]) = ((__pyx_v_I_nmda_slow[__pyx_v_i]) + (__pyx_v_s->i_nmda_mu * (__pyx_v_s->i_nmda_s - (__pyx_v_I_nmda_slow[__pyx_v_i]))));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":429 */
      (__pyx_v_I_nmda_fast[__pyx_v_i]) = ((__pyx_v_I_nmda_fast[__pyx_v_i]) + (__pyx_v_s->i_nmda_mu * (__pyx_v_s->i_nmda_f - (__pyx_v_I_nmda_fast[__pyx_v_i]))));
      goto __pyx_L20;
    }
    __pyx_L20:;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":431 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":434 */
      __pyx_v_B = (1.0 / (1.0 + (exp((__pyx_v_s->mg1 * (__pyx_v_v_total[__pyx_v_c]))) / __pyx_v_s->mg2)));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":437 */
      __pyx_3 = PyFloat_FromDouble(__pyx_v_B); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; goto __pyx_L1;}
      __pyx_4 = PyFloat_FromDouble((__pyx_v_v_total[__pyx_v_c])); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; goto __pyx_L1;}
      __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_v_reversal); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; goto __pyx_L1;}
      __pyx_6 = PyNumber_Subtract(__pyx_4, __pyx_5); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_4 = PyNumber_Multiply(__pyx_3, __pyx_6); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_7 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_h = __pyx_7;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":440 */
      (__pyx_v_I_nmda[__pyx_v_c]) = (((__pyx_v_g_nmda[__pyx_v_c]) * ((__pyx_v_I_nmda_fast[__pyx_v_c]) + (__pyx_v_I_nmda_slow[__pyx_v_c]))) * __pyx_v_h);

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":442 */
      (__pyx_v_Ca[__pyx_v_c]) = ((__pyx_v_Ca[__pyx_v_c]) + (((__pyx_v_I_nmda[__pyx_v_c]) - ((__pyx_v_Ca[__pyx_v_c]) / __pyx_v_s->tau_ca)) * __pyx_v_s->dt));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":453 */
      __pyx_2 = (__pyx_v_s->learning_rule == 1);
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":454 */
        __pyx_v_omega = (__pyx_v_s->omega_offset + (__pyx_f_8simutils_sig(((__pyx_v_Ca[__pyx_v_c]) - __pyx_v_s->alpha2),__pyx_v_s->beta2) - (0.5 * __pyx_f_8simutils_sig(((__pyx_v_Ca[__pyx_v_c]) - __pyx_v_s->alpha1),__pyx_v_s->beta1))));

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":456 */
        __pyx_v_eta = (__pyx_v_s->eta_gamma0 * (__pyx_v_Ca[__pyx_v_c]));
        goto __pyx_L23;
      }
      __pyx_2 = (__pyx_v_s->learning_rule == 2);
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":458 */
        __pyx_v_omega = (__pyx_v_s->omega_offset + ((__pyx_v_Ca[__pyx_v_c]) * ((__pyx_v_Ca[__pyx_v_c]) - __pyx_v_s->theta_o)));

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":459 */
        __pyx_2 = (__pyx_v_omega > __pyx_v_s->omega_max);
        if (__pyx_2) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":460 */
          __pyx_v_omega = __pyx_v_s->omega_max;
          goto __pyx_L24;
        }
        __pyx_L24:;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":461 */
        __pyx_2 = (__pyx_v_omega < 0.0);
        if (__pyx_2) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":462 */
          __pyx_v_eta = __pyx_v_s->eta_down;
          goto __pyx_L25;
        }
        /*else*/ {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":464 */
          __pyx_v_eta = __pyx_v_s->eta_up;
        }
        __pyx_L25:;
        goto __pyx_L23;
      }
      __pyx_2 = (__pyx_v_s->learning_rule == 3);
      if (!__pyx_2) {
        __pyx_2 = (__pyx_v_s->learning_rule == 4);
      }
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":480 */
        __pyx_v_omega = (__pyx_v_s->omega_offset + (__pyx_f_8simutils_sig(((__pyx_v_Ca[__pyx_v_c]) - __pyx_v_s->alpha2),__pyx_v_s->beta2) - (0.5 * __pyx_f_8simutils_sig(((__pyx_v_Ca[__pyx_v_c]) - __pyx_v_s->alpha1),__pyx_v_s->beta1))));

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":482 */
        __pyx_v_eta = (__pyx_v_s->eta_gamma0 * (__pyx_v_Ca[__pyx_v_c]));

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":484 */
        __pyx_2 = (__pyx_v_s->learning_rule == 3);
        if (__pyx_2) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":485 */
          __pyx_5 = PyFloat_FromDouble(__pyx_v_s->eta_p1); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_3 = __Pyx_GetName(__pyx_b, __pyx_n_pow); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_6 = PyFloat_FromDouble(((__pyx_v_Ca[__pyx_v_c]) + __pyx_v_s->eta_p4)); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_4 = PyFloat_FromDouble(__pyx_v_s->eta_p3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_8 = PyTuple_New(2); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_8, 0, __pyx_6);
          PyTuple_SET_ITEM(__pyx_8, 1, __pyx_4);
          __pyx_6 = 0;
          __pyx_4 = 0;
          __pyx_6 = PyObject_CallObject(__pyx_3, __pyx_8); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_8); __pyx_8 = 0;
          __pyx_4 = PyNumber_Multiply(__pyx_5, __pyx_6); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_3 = __Pyx_GetName(__pyx_b, __pyx_n_pow); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_8 = PyFloat_FromDouble(((__pyx_v_Ca[__pyx_v_c]) + __pyx_v_s->eta_p4)); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_5 = PyFloat_FromDouble(__pyx_v_s->eta_p3); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_6, 0, __pyx_8);
          PyTuple_SET_ITEM(__pyx_6, 1, __pyx_5);
          __pyx_8 = 0;
          __pyx_5 = 0;
          __pyx_8 = PyObject_CallObject(__pyx_3, __pyx_6); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_5 = __Pyx_GetName(__pyx_b, __pyx_n_pow); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_3 = PyFloat_FromDouble(__pyx_v_s->eta_p2); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_6 = PyFloat_FromDouble(__pyx_v_s->eta_p3); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          __pyx_9 = PyTuple_New(2); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_9, 0, __pyx_3);
          PyTuple_SET_ITEM(__pyx_9, 1, __pyx_6);
          __pyx_3 = 0;
          __pyx_6 = 0;
          __pyx_3 = PyObject_CallObject(__pyx_5, __pyx_9); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          Py_DECREF(__pyx_9); __pyx_9 = 0;
          __pyx_6 = PyNumber_Add(__pyx_8, __pyx_3); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          Py_DECREF(__pyx_8); __pyx_8 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_5 = PyNumber_Divide(__pyx_4, __pyx_6); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_7 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 485; goto __pyx_L1;}
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          __pyx_v_eta = __pyx_7;
          goto __pyx_L26;
        }
        /*else*/ {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":487 */
          __pyx_9 = PyFloat_FromDouble(__pyx_v_s->eta_p2); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_8 = __Pyx_GetName(__pyx_b, __pyx_n_pow); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_3 = PyFloat_FromDouble((__pyx_v_Ca[__pyx_v_c])); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_4 = PyFloat_FromDouble(__pyx_v_s->eta_p3); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_6 = PyTuple_New(2); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_6, 0, __pyx_3);
          PyTuple_SET_ITEM(__pyx_6, 1, __pyx_4);
          __pyx_3 = 0;
          __pyx_4 = 0;
          __pyx_5 = PyObject_CallObject(__pyx_8, __pyx_6); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_8); __pyx_8 = 0;
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_3 = PyNumber_Add(__pyx_9, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_9); __pyx_9 = 0;
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          __pyx_4 = PyFloat_FromDouble(__pyx_v_s->eta_p1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_8 = PyFloat_FromDouble(__pyx_v_s->eta_p4); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_6 = PyFloat_FromDouble(__pyx_v_s->eta_p2); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_9 = __Pyx_GetName(__pyx_b, __pyx_n_pow); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_5 = PyFloat_FromDouble((__pyx_v_Ca[__pyx_v_c])); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_10 = PyFloat_FromDouble(__pyx_v_s->eta_p3); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          __pyx_11 = PyTuple_New(2); if (!__pyx_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_11, 0, __pyx_5);
          PyTuple_SET_ITEM(__pyx_11, 1, __pyx_10);
          __pyx_5 = 0;
          __pyx_10 = 0;
          __pyx_5 = PyObject_CallObject(__pyx_9, __pyx_11); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_9); __pyx_9 = 0;
          Py_DECREF(__pyx_11); __pyx_11 = 0;
          __pyx_10 = PyNumber_Add(__pyx_6, __pyx_5); if (!__pyx_10) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          Py_DECREF(__pyx_5); __pyx_5 = 0;
          __pyx_9 = PyNumber_Multiply(__pyx_8, __pyx_10); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_8); __pyx_8 = 0;
          Py_DECREF(__pyx_10); __pyx_10 = 0;
          __pyx_11 = PyNumber_Add(__pyx_4, __pyx_9); if (!__pyx_11) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          Py_DECREF(__pyx_9); __pyx_9 = 0;
          __pyx_6 = PyNumber_Divide(__pyx_3, __pyx_11); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_11); __pyx_11 = 0;
          __pyx_7 = PyFloat_AsDouble(__pyx_6); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_v_eta = __pyx_7;
        }
        __pyx_L26:;
        goto __pyx_L23;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":489 */
        __pyx_5 = __Pyx_GetName(__pyx_b, __pyx_n_ValueError); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 489; goto __pyx_L1;}
        __Pyx_Raise(__pyx_5, __pyx_k12p, 0);
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 489; goto __pyx_L1;}
      }
      __pyx_L23:;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":491 */
      (__pyx_v_weights[__pyx_v_c]) = ((__pyx_v_weights[__pyx_v_c]) + (__pyx_v_eta * (__pyx_v_omega - (__pyx_v_s->lambda_decay * (__pyx_v_weights[__pyx_v_c])))));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":493 */
      __pyx_v_c = (__pyx_v_c + 1);
    }
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":498 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":499 */
    (__pyx_v_I_nmda_slow[__pyx_v_i]) = ((__pyx_v_I_nmda_slow[__pyx_v_i]) - ((__pyx_v_I_nmda_slow[__pyx_v_i]) / __pyx_v_s->tau_nmda_s));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":500 */
    (__pyx_v_I_nmda_fast[__pyx_v_i]) = ((__pyx_v_I_nmda_fast[__pyx_v_i]) - ((__pyx_v_I_nmda_fast[__pyx_v_i]) / __pyx_v_s->tau_nmda_f));
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":502 */
  for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":503 */
    (__pyx_v_v_backspike_slow[__pyx_v_o]) = ((__pyx_v_v_backspike_slow[__pyx_v_o]) - ((__pyx_v_v_backspike_slow[__pyx_v_o]) / __pyx_v_s->tau_backspike_slow));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":504 */
    (__pyx_v_v_backspike_fast[__pyx_v_o]) = ((__pyx_v_v_backspike_fast[__pyx_v_o]) - ((__pyx_v_v_backspike_fast[__pyx_v_o]) / __pyx_v_s->tau_backspike_fast));
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  Py_XDECREF(__pyx_11);
  __Pyx_AddTraceback("simutils.Calcium_update");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_STDP_update(struct __pyx_t_8simutils_Connection_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_output_num;
  int __pyx_v_input_num;
  double (*__pyx_v_M);
  double (*__pyx_v_P);
  double (*__pyx_v_weights);
  char (*__pyx_v_outspike);
  char (*__pyx_v_inspike);
  double __pyx_v_tau_minus;
  double __pyx_v_tau_plus;
  double __pyx_v_a_minus;
  double __pyx_v_a_plus;
  double __pyx_v_sign;
  double __pyx_v_g_max;
  double __pyx_v_dt;
  int __pyx_v_count;
  int __pyx_v_nearest_neighbor;
  int __pyx_v_o;
  int __pyx_v_i;
  PyObject *__pyx_r;
  char __pyx_1;
  int __pyx_2;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":518 */
  __pyx_v_tau_minus = __pyx_v_s->tau_minus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":519 */
  __pyx_v_tau_plus = __pyx_v_s->tau_plus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":520 */
  __pyx_v_a_minus = __pyx_v_s->a_minus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":521 */
  __pyx_v_a_plus = __pyx_v_s->a_plus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":522 */
  __pyx_v_sign = __pyx_v_s->sign;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":523 */
  __pyx_v_g_max = __pyx_v_s->g_max;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":524 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":525 */
  __pyx_v_nearest_neighbor = __pyx_v_s->nearest_neighbor;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":527 */
  __pyx_v_M = __pyx_v_s->M;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":528 */
  __pyx_v_P = __pyx_v_s->P;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":530 */
  __pyx_v_weights = __pyx_v_s->weights;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":531 */
  __pyx_v_outspike = __pyx_v_s->outspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":532 */
  __pyx_v_inspike = __pyx_v_s->inspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":533 */
  __pyx_v_output_num = __pyx_v_s->output_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":534 */
  __pyx_v_input_num = __pyx_v_s->input_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":540 */
  for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":541 */
    (__pyx_v_M[__pyx_v_o]) = ((__pyx_v_M[__pyx_v_o]) - (((__pyx_v_M[__pyx_v_o]) * __pyx_v_dt) / __pyx_v_tau_minus));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":542 */
    __pyx_1 = (__pyx_v_outspike[__pyx_v_o]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":543 */
      __pyx_2 = __pyx_v_nearest_neighbor;
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":544 */
        (__pyx_v_M[__pyx_v_o]) = ((-__pyx_v_a_minus) * __pyx_v_sign);
        goto __pyx_L5;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":546 */
        (__pyx_v_M[__pyx_v_o]) = ((__pyx_v_M[__pyx_v_o]) - (__pyx_v_a_minus * __pyx_v_sign));
      }
      __pyx_L5:;
      goto __pyx_L4;
    }
    __pyx_L4:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":548 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":549 */
    (__pyx_v_P[__pyx_v_i]) = ((__pyx_v_P[__pyx_v_i]) - (((__pyx_v_P[__pyx_v_i]) * __pyx_v_dt) / __pyx_v_tau_plus));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":550 */
    __pyx_1 = (__pyx_v_inspike[__pyx_v_i]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":551 */
      __pyx_2 = __pyx_v_nearest_neighbor;
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":552 */
        (__pyx_v_P[__pyx_v_i]) = (__pyx_v_a_plus * __pyx_v_sign);
        goto __pyx_L9;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":554 */
        (__pyx_v_P[__pyx_v_i]) = ((__pyx_v_P[__pyx_v_i]) + (__pyx_v_a_plus * __pyx_v_sign));
      }
      __pyx_L9:;
      goto __pyx_L8;
    }
    __pyx_L8:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":556 */
  __pyx_v_count = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":557 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":558 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":560 */
      (__pyx_v_weights[__pyx_v_count]) = ((__pyx_v_weights[__pyx_v_count]) + (((((__pyx_v_M[__pyx_v_o]) * (__pyx_v_inspike[__pyx_v_i])) * __pyx_v_g_max) + (((__pyx_v_P[__pyx_v_i]) * (__pyx_v_outspike[__pyx_v_o])) * __pyx_v_g_max)) * __pyx_v_sign));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":563 */
      __pyx_v_count = (__pyx_v_count + 1);
    }
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Gerstner06_update(struct __pyx_t_8simutils_Connection_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_output_num;
  int __pyx_v_input_num;
  double (*__pyx_v_r1);
  double (*__pyx_v_r2);
  double (*__pyx_v_o1);
  double (*__pyx_v_o2);
  double (*__pyx_v_weights);
  char (*__pyx_v_outspike);
  char (*__pyx_v_inspike);
  double __pyx_v_tau_minus;
  double __pyx_v_tau_plus;
  double __pyx_v_tau_x;
  double __pyx_v_tau_y;
  double __pyx_v_A2_minus;
  double __pyx_v_A2_plus;
  double __pyx_v_A3_minus;
  double __pyx_v_A3_plus;
  double __pyx_v_sign;
  double __pyx_v_dt;
  int __pyx_v_o;
  int __pyx_v_i;
  int __pyx_v_c;
  PyObject *__pyx_r;
  char __pyx_1;
  int __pyx_2;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":575 */
  __pyx_v_tau_minus = __pyx_v_s->tau_minus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":576 */
  __pyx_v_tau_plus = __pyx_v_s->tau_plus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":577 */
  __pyx_v_tau_x = __pyx_v_s->tau_x;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":578 */
  __pyx_v_tau_y = __pyx_v_s->tau_y;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":579 */
  __pyx_v_A2_minus = __pyx_v_s->A2_minus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":580 */
  __pyx_v_A3_minus = __pyx_v_s->A3_minus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":581 */
  __pyx_v_A2_plus = __pyx_v_s->A2_plus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":582 */
  __pyx_v_A3_plus = __pyx_v_s->A3_plus;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":584 */
  __pyx_v_sign = __pyx_v_s->sign;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":585 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":587 */
  __pyx_v_r1 = __pyx_v_s->r1;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":588 */
  __pyx_v_r2 = __pyx_v_s->r2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":589 */
  __pyx_v_o1 = __pyx_v_s->o1;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":590 */
  __pyx_v_o2 = __pyx_v_s->o2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":593 */
  __pyx_v_weights = __pyx_v_s->weights;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":594 */
  __pyx_v_outspike = __pyx_v_s->outspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":595 */
  __pyx_v_inspike = __pyx_v_s->inspike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":596 */
  __pyx_v_output_num = __pyx_v_s->output_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":597 */
  __pyx_v_input_num = __pyx_v_s->input_num;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":604 */
  for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":605 */
    (__pyx_v_o1[__pyx_v_o]) = ((__pyx_v_o1[__pyx_v_o]) - (((__pyx_v_o1[__pyx_v_o]) * __pyx_v_dt) / __pyx_v_tau_minus));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":606 */
    __pyx_1 = (__pyx_v_outspike[__pyx_v_o]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":607 */
      __pyx_2 = __pyx_v_s->nearest_neighbor;
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":608 */
        (__pyx_v_o1[__pyx_v_o]) = 1.0;
        goto __pyx_L5;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":610 */
        (__pyx_v_o1[__pyx_v_o]) = ((__pyx_v_o1[__pyx_v_o]) + 1.0);
      }
      __pyx_L5:;
      goto __pyx_L4;
    }
    __pyx_L4:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":612 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":613 */
    (__pyx_v_r1[__pyx_v_i]) = ((__pyx_v_r1[__pyx_v_i]) - (((__pyx_v_r1[__pyx_v_i]) * __pyx_v_dt) / __pyx_v_tau_plus));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":614 */
    __pyx_1 = (__pyx_v_inspike[__pyx_v_i]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":615 */
      __pyx_2 = __pyx_v_s->nearest_neighbor;
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":616 */
        (__pyx_v_r1[__pyx_v_i]) = 1.0;
        goto __pyx_L9;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":618 */
        (__pyx_v_r1[__pyx_v_i]) = ((__pyx_v_r1[__pyx_v_i]) + 1.0);
      }
      __pyx_L9:;
      goto __pyx_L8;
    }
    __pyx_L8:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":623 */
  __pyx_v_c = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":624 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":625 */
    for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":628 */
      (__pyx_v_weights[__pyx_v_c]) = ((__pyx_v_weights[__pyx_v_c]) + ((((-(__pyx_v_inspike[__pyx_v_i])) * (__pyx_v_o1[__pyx_v_o])) * (__pyx_v_A2_minus + (__pyx_v_A3_minus * (__pyx_v_r2[__pyx_v_i])))) + (((__pyx_v_outspike[__pyx_v_o]) * (__pyx_v_r1[__pyx_v_i])) * (__pyx_v_A2_plus + (__pyx_v_A3_plus * (__pyx_v_o2[__pyx_v_o]))))));

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":632 */
      __pyx_v_c = (__pyx_v_c + 1);
    }
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":638 */
  for (__pyx_v_o = 0; __pyx_v_o < __pyx_v_output_num; ++__pyx_v_o) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":639 */
    (__pyx_v_o2[__pyx_v_o]) = ((__pyx_v_o2[__pyx_v_o]) - (((__pyx_v_o2[__pyx_v_o]) * __pyx_v_dt) / __pyx_v_tau_y));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":640 */
    __pyx_1 = (__pyx_v_outspike[__pyx_v_o]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":641 */
      __pyx_2 = __pyx_v_s->nearest_neighbor;
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":642 */
        (__pyx_v_o2[__pyx_v_o]) = 1.0;
        goto __pyx_L17;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":644 */
        (__pyx_v_o2[__pyx_v_o]) = ((__pyx_v_o2[__pyx_v_o]) + 1.0);
      }
      __pyx_L17:;
      goto __pyx_L16;
    }
    __pyx_L16:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":646 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_input_num; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":647 */
    (__pyx_v_r2[__pyx_v_i]) = ((__pyx_v_r2[__pyx_v_i]) - (((__pyx_v_r2[__pyx_v_i]) * __pyx_v_dt) / __pyx_v_tau_x));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":648 */
    __pyx_1 = (__pyx_v_inspike[__pyx_v_i]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":649 */
      __pyx_2 = __pyx_v_s->nearest_neighbor;
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":650 */
        (__pyx_v_r2[__pyx_v_i]) = 1.0;
        goto __pyx_L21;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":652 */
        (__pyx_v_r2[__pyx_v_i]) = ((__pyx_v_r2[__pyx_v_i]) + 1.0);
      }
      __pyx_L21:;
      goto __pyx_L20;
    }
    __pyx_L20:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_n_update;
static PyObject *__pyx_n_TypeError;

static PyObject *__pyx_k13p;

static char (__pyx_k13[]) = "Unknown type: %d";

static PyObject *__pyx_f_8simutils_cupdate(struct __pyx_t_8simutils_Connection_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":659 */
  __pyx_1 = (__pyx_v_s->type == (-1));
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":660 */
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_update); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 660; goto __pyx_L1;}
    __pyx_3 = PyFloat_FromDouble(__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 660; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 660; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 660; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":661 */
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":663 */
  __pyx_1 = (__pyx_v_s->type == 0);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":664 */
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 1);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":666 */
    __pyx_2 = __pyx_f_8simutils_Spiking_Rate_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 2);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":668 */
    __pyx_4 = __pyx_f_8simutils_Calcium_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 668; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 3);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":670 */
    __pyx_3 = __pyx_f_8simutils_STDP_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 670; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 4);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":672 */
    __pyx_2 = __pyx_f_8simutils_Gerstner06_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_connection_groups.pyx":674 */
    __pyx_4 = __Pyx_GetName(__pyx_b, __pyx_n_TypeError); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; goto __pyx_L1;}
    __pyx_3 = PyInt_FromLong(__pyx_v_s->type); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; goto __pyx_L1;}
    __pyx_2 = PyNumber_Remainder(__pyx_k13p, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_Raise(__pyx_4, __pyx_2, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; goto __pyx_L1;}
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("simutils.cupdate");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_copy_spikes(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s)) {
  int __pyx_v_i;
  PyObject *__pyx_r;
  int __pyx_1;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":54 */
  __pyx_1 = __pyx_v_s->quantity;
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_1; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":55 */
    (__pyx_v_s->old_spike[__pyx_v_i]) = (__pyx_v_s->spike[__pyx_v_i]);
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  return __pyx_r;
}

static PyObject *__pyx_n_quantity;
static PyObject *__pyx_n_len;
static PyObject *__pyx_n_connections_to;
static PyObject *__pyx_n_save_spike_range;
static PyObject *__pyx_n_g;
static PyObject *__pyx_n_time_to_next_spike;
static PyObject *__pyx_n_min_latency;
static PyObject *__pyx_n_max_latency;
static PyObject *__pyx_n_time_between_rates;
static PyObject *__pyx_n_time_to_next_rate;
static PyObject *__pyx_n_rate;
static PyObject *__pyx_n_sequential;
static PyObject *__pyx_n_which_rate;
static PyObject *__pyx_n_time_to_stop_refract;
static PyObject *__pyx_n_V_reset;
static PyObject *__pyx_n_tau_m;
static PyObject *__pyx_n_tau_ex;
static PyObject *__pyx_n_tau_in;
static PyObject *__pyx_n_reset_adaptation;
static PyObject *__pyx_n_t_refract;
static PyObject *__pyx_n_V_rev_exc;
static PyObject *__pyx_n_V_rev_inh;
static PyObject *__pyx_n_V_thresh;
static PyObject *__pyx_n_g_exc_max;
static PyObject *__pyx_n_g_inh_max;
static PyObject *__pyx_n_pattern_count;
static PyObject *__pyx_n_pattern_length;
static PyObject *__pyx_n_time_to_next_pattern;
static PyObject *__pyx_n_time_for_last_pattern;
static PyObject *__pyx_n_u;
static PyObject *__pyx_n_epsp1;
static PyObject *__pyx_n_epsp2;
static PyObject *__pyx_n_ipsp1;
static PyObject *__pyx_n_ipsp2;
static PyObject *__pyx_n_a;
static PyObject *__pyx_n_b;
static PyObject *__pyx_n_c;
static PyObject *__pyx_n_d;
static PyObject *__pyx_n_I;
static PyObject *__pyx_n_tau_epsp1;
static PyObject *__pyx_n_tau_epsp2;
static PyObject *__pyx_n_V_peak;
static PyObject *__pyx_n_epsp_scale;

static PyObject *__pyx_k14p;
static PyObject *__pyx_k15p;
static PyObject *__pyx_k16p;
static PyObject *__pyx_k17p;
static PyObject *__pyx_k18p;
static PyObject *__pyx_k19p;
static PyObject *__pyx_k20p;
static PyObject *__pyx_k21p;
static PyObject *__pyx_k22p;

static char (__pyx_k14[]) = "splikes.neuron_groups.Silent_Neuron";
static char (__pyx_k15[]) = "splikes.neuron_groups.Constant_Fixed";
static char (__pyx_k16[]) = "splikes.neuron_groups.Constant_Poisson";
static char (__pyx_k17[]) = "splikes.neuron_groups.Variable_Poisson";
static char (__pyx_k18[]) = "splikes.neuron_groups.Integrate_and_Fire";
static char (__pyx_k19[]) = "splikes.neuron_groups.Stochastic_Rate";
static char (__pyx_k20[]) = "splikes.neuron_groups.Spike_Pattern";
static char (__pyx_k21[]) = "splikes.neuron_groups.Izh";
static char (__pyx_k22[]) = "Unimplemented Neuron_Group Update";

static struct __pyx_t_8simutils_Neuron_Group_struct __pyx_f_8simutils_init_Neuron_Group(PyObject *__pyx_v_self) {
  struct __pyx_t_8simutils_Neuron_Group_struct __pyx_v_s;
  int __pyx_v_cg;
  struct __pyx_t_8simutils_Neuron_Group_struct __pyx_r;
  PyObject *__pyx_1 = 0;
  double __pyx_2;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  int __pyx_6;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":65 */
  __pyx_v_s.type = (-1);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":66 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_dt); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; goto __pyx_L1;}
  __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_s.dt = __pyx_2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":67 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_quantity); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 67; goto __pyx_L1;}
  __pyx_3 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 67; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_s.quantity = __pyx_3;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":68 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_spike); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 68; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 68; goto __pyx_L1;}
  __pyx_v_s.spike = __pyx_f_8simutils_CharData(((PyArrayObject *)__pyx_1));
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":69 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_old_spike); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 69; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 69; goto __pyx_L1;}
  __pyx_v_s.old_spike = __pyx_f_8simutils_CharData(((PyArrayObject *)__pyx_1));
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":70 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_len); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 70; goto __pyx_L1;}
  __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connections_to); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 70; goto __pyx_L1;}
  __pyx_5 = PyTuple_New(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 70; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_4);
  __pyx_4 = 0;
  __pyx_4 = PyObject_CallObject(__pyx_1, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 70; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_3 = PyInt_AsLong(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 70; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_v_s.number_of_connection_groups_to = __pyx_3;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":71 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_save_spike_range); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 71; goto __pyx_L1;}
  __pyx_5 = PyInt_FromLong(0); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 71; goto __pyx_L1;}
  __pyx_4 = PyObject_GetItem(__pyx_1, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 71; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 71; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  (__pyx_v_s.save_spike_range[0]) = __pyx_2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":72 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_save_spike_range); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 72; goto __pyx_L1;}
  __pyx_5 = PyInt_FromLong(1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 72; goto __pyx_L1;}
  __pyx_4 = PyObject_GetItem(__pyx_1, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 72; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 72; goto __pyx_L1;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  (__pyx_v_s.save_spike_range[1]) = __pyx_2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":73 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_V); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 73; goto __pyx_L1;}
  if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 73; goto __pyx_L1;}
  __pyx_v_s.V = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":77 */
  __pyx_3 = __pyx_v_s.number_of_connection_groups_to;
  for (__pyx_v_cg = 0; __pyx_v_cg < __pyx_3; ++__pyx_v_cg) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":78 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connections_to); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
    __pyx_4 = PyInt_FromLong(__pyx_v_cg); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
    __pyx_1 = PyObject_GetItem(__pyx_5, __pyx_4); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyObject_GetAttr(__pyx_1, __pyx_n_incell); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_4 = PyObject_GetAttr(__pyx_5, __pyx_n_old_spike); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    if (!__Pyx_TypeTest(__pyx_4, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; goto __pyx_L1;}
    (__pyx_v_s.c_old_spike[__pyx_v_cg]) = __pyx_f_8simutils_CharData(((PyArrayObject *)__pyx_4));
    Py_DECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":79 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connections_to); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 79; goto __pyx_L1;}
    __pyx_5 = PyInt_FromLong(__pyx_v_cg); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 79; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_1, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 79; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_1 = PyObject_GetAttr(__pyx_4, __pyx_n_incell); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 79; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyObject_GetAttr(__pyx_1, __pyx_n_quantity); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 79; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_6 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 79; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    (__pyx_v_s.c_num_incell[__pyx_v_cg]) = __pyx_6;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":80 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connections_to); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; goto __pyx_L1;}
    __pyx_1 = PyInt_FromLong(__pyx_v_cg); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; goto __pyx_L1;}
    __pyx_5 = PyObject_GetItem(__pyx_4, __pyx_1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_4 = PyObject_GetAttr(__pyx_5, __pyx_n_outcell); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_1 = PyObject_GetAttr(__pyx_4, __pyx_n_quantity); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_6 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    (__pyx_v_s.c_num_outcell[__pyx_v_cg]) = __pyx_6;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":82 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connections_to); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 82; goto __pyx_L1;}
    __pyx_4 = PyInt_FromLong(__pyx_v_cg); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 82; goto __pyx_L1;}
    __pyx_1 = PyObject_GetItem(__pyx_5, __pyx_4); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 82; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_5 = PyObject_GetAttr(__pyx_1, __pyx_n_sign); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 82; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_6 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 82; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    (__pyx_v_s.c_sign[__pyx_v_cg]) = __pyx_6;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":83 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connections_to); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; goto __pyx_L1;}
    __pyx_1 = PyInt_FromLong(__pyx_v_cg); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; goto __pyx_L1;}
    __pyx_5 = PyObject_GetItem(__pyx_4, __pyx_1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_4 = PyObject_GetAttr(__pyx_5, __pyx_n_g); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    if (!__Pyx_TypeTest(__pyx_4, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; goto __pyx_L1;}
    (__pyx_v_s.c_g[__pyx_v_cg]) = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_4));
    Py_DECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":84 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_connections_to); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; goto __pyx_L1;}
    __pyx_5 = PyInt_FromLong(__pyx_v_cg); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; goto __pyx_L1;}
    __pyx_4 = PyObject_GetItem(__pyx_1, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_1 = PyObject_GetAttr(__pyx_4, __pyx_n_weights); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; goto __pyx_L1;}
    (__pyx_v_s.c_weights[__pyx_v_cg]) = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":88 */
  __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_5, __pyx_k14p, &__pyx_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; goto __pyx_L1;}
  __pyx_6 = __pyx_6 == 0;
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  if (__pyx_6) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":89 */
    __pyx_v_s.type = 0;
    goto __pyx_L4;
  }
  __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 90; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_4, __pyx_k15p, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 90; goto __pyx_L1;}
  __pyx_3 = __pyx_3 == 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_3) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":91 */
    __pyx_v_s.type = 1;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":92 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_time_to_next_spike); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 92; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 92; goto __pyx_L1;}
    __pyx_v_s.time_to_next_spike = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":93 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_min_latency); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 93; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 93; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.min_latency = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":94 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_max_latency); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.max_latency = __pyx_2;
    goto __pyx_L4;
  }
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 96; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_1, __pyx_k16p, &__pyx_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 96; goto __pyx_L1;}
  __pyx_6 = __pyx_6 == 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_6) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":97 */
    __pyx_v_s.type = 2;
    goto __pyx_L4;
  }
  __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 98; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_5, __pyx_k17p, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 98; goto __pyx_L1;}
  __pyx_3 = __pyx_3 == 0;
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  if (__pyx_3) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":99 */
    __pyx_v_s.type = 3;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":100 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_time_between_rates); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.time_between_rates = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":101 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_time_to_next_rate); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.time_to_next_rate = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":102 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_rate); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; goto __pyx_L1;}
    __pyx_v_s.rate = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_5));
    Py_DECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":103 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_rate); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_4, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; goto __pyx_L1;}
    __pyx_v_s.number_of_rates = __pyx_f_8simutils_Dim0(((PyArrayObject *)__pyx_4));
    Py_DECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":104 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_sequential); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; goto __pyx_L1;}
    __pyx_6 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.sequential = __pyx_6;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":105 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_which_rate); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 105; goto __pyx_L1;}
    __pyx_3 = PyInt_AsLong(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 105; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.which_rate = __pyx_3;
    goto __pyx_L4;
  }
  __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 106; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_4, __pyx_k18p, &__pyx_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 106; goto __pyx_L1;}
  __pyx_6 = __pyx_6 == 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_6) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":107 */
    __pyx_v_s.type = 4;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":108 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_time_to_stop_refract); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; goto __pyx_L1;}
    __pyx_v_s.time_to_stop_refract = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":109 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_V_reset); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 109; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 109; goto __pyx_L1;}
    __pyx_v_s.V_reset = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_5));
    Py_DECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":110 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_m); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.tau_m = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":111 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_ex); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 111; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 111; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_ex = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":112 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_in); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.tau_in = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":113 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_reset_adaptation); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 113; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 113; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.reset_adaptation = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":114 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_t_refract); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 114; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 114; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.t_refract = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":115 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_V_rev_exc); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.V_rev_exc = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":116 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_V_rev_inh); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 116; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 116; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.V_rev_inh = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":117 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_V_thresh); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 117; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 117; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.V_thresh = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":118 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_g_exc_max); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 118; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 118; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.g_exc_max = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":119 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_g_inh_max); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.g_inh_max = __pyx_2;
    goto __pyx_L4;
  }
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 121; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_1, __pyx_k19p, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 121; goto __pyx_L1;}
  __pyx_3 = __pyx_3 == 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_3) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":122 */
    __pyx_v_s.type = 5;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":123 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_y); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 123; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 123; goto __pyx_L1;}
    __pyx_v_s.y = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_5));
    Py_DECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":124 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_activation_magnitude); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 124; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 124; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.activation_magnitude = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":125 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_activation); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.tau_activation = __pyx_2;
    goto __pyx_L4;
  }
  __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_5, __pyx_k20p, &__pyx_6) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; goto __pyx_L1;}
  __pyx_6 = __pyx_6 == 0;
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  if (__pyx_6) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":127 */
    __pyx_v_s.type = 6;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":128 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_rate); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 128; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 128; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.rate_val = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":129 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_time_to_next_spike); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; goto __pyx_L1;}
    __pyx_v_s.time_to_next_spike = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":130 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_pattern_count); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 130; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 130; goto __pyx_L1;}
    __pyx_v_s.pattern_count = __pyx_f_8simutils_IntData(((PyArrayObject *)__pyx_5));
    Py_DECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":131 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_pattern_length); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 131; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_4, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 131; goto __pyx_L1;}
    __pyx_v_s.pattern_length = __pyx_f_8simutils_IntData(((PyArrayObject *)__pyx_4));
    Py_DECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":132 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_time_to_next_pattern); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 132; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 132; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.time_to_next_pattern = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":133 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_time_for_last_pattern); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 133; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 133; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.time_for_last_pattern = __pyx_2;
    goto __pyx_L4;
  }
  __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 134; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_4, __pyx_k21p, &__pyx_3) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 134; goto __pyx_L1;}
  __pyx_3 = __pyx_3 == 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  if (__pyx_3) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":135 */
    __pyx_v_s.type = 7;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":136 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_u); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; goto __pyx_L1;}
    __pyx_v_s.u = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":137 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_epsp1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; goto __pyx_L1;}
    __pyx_v_s.epsp1 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_5));
    Py_DECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":138 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_epsp2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_4, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; goto __pyx_L1;}
    __pyx_v_s.epsp2 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_4));
    Py_DECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":139 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_ipsp1); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 139; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 139; goto __pyx_L1;}
    __pyx_v_s.ipsp1 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":140 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_ipsp2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_5, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; goto __pyx_L1;}
    __pyx_v_s.ipsp2 = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_5));
    Py_DECREF(__pyx_5); __pyx_5 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":141 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_a); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.a = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":142 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_b); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 142; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 142; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.b = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":143 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_c); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 143; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 143; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.c = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":144 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_d); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.d = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":145 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_I); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.I = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":146 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_epsp1); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 146; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 146; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.tau_epsp1 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":147 */
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_tau_epsp2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 147; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 147; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_v_s.tau_epsp2 = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":148 */
    __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_V_peak); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 148; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 148; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_s.V_peak = __pyx_2;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":149 */
    __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_epsp_scale); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; goto __pyx_L1;}
    __pyx_2 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; goto __pyx_L1;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_v_s.epsp_scale = __pyx_2;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":153 */
    if (__Pyx_PrintItem(__pyx_k22p) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 153; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n___module__); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 153; goto __pyx_L1;}
    if (__Pyx_PrintItem(__pyx_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 153; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__Pyx_PrintNewline() < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 153; goto __pyx_L1;}
  }
  __pyx_L4:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":155 */
  __pyx_r = __pyx_v_s;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_WriteUnraisable("simutils.init_Neuron_Group");
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_n_save_spikes;

static PyObject *__pyx_f_8simutils_save_spikes(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":160 */
  __pyx_1 = (__pyx_v_t >= (__pyx_v_s->save_spike_range[0]));
  if (__pyx_1) {
    __pyx_1 = (__pyx_v_t <= (__pyx_v_s->save_spike_range[1]));
  }
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":161 */
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_save_spikes); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 161; goto __pyx_L1;}
    __pyx_3 = PyFloat_FromDouble(__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 161; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 161; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 161; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("simutils.save_spikes");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Silent_Neuron_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  PyObject *__pyx_r;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":165 */

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Constant_Fixed_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_i;
  int __pyx_v_qty;
  double (*__pyx_v_ttn);
  double __pyx_v_dt;
  char (*__pyx_v_spike);
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  double __pyx_2;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":171 */
  __pyx_v_qty = __pyx_v_s->quantity;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":174 */
  __pyx_v_ttn = __pyx_v_s->time_to_next_spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":177 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_dt); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 177; goto __pyx_L1;}
  __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 177; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_dt = __pyx_2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":179 */
  __pyx_3 = (__pyx_v_t == 0);
  if (__pyx_3) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":180 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_qty; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":181 */
      (__pyx_v_ttn[__pyx_v_i]) = floor(((randu() * (__pyx_v_s->max_latency - __pyx_v_s->min_latency)) + __pyx_v_s->min_latency));
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":185 */
  __pyx_v_spike = __pyx_v_s->spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":187 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_qty; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":188 */
    __pyx_3 = (__pyx_v_t >= (__pyx_v_ttn[__pyx_v_i]));
    if (__pyx_3) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":189 */
      (__pyx_v_spike[__pyx_v_i]) = 1;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":190 */
      __pyx_1 = PyFloat_FromDouble((__pyx_v_ttn[__pyx_v_i])); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 190; goto __pyx_L1;}
      __pyx_4 = PyFloat_FromDouble((1000.0 * __pyx_v_dt)); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 190; goto __pyx_L1;}
      __pyx_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_rate); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 190; goto __pyx_L1;}
      __pyx_6 = PyNumber_Divide(__pyx_4, __pyx_5); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 190; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_4 = PyNumber_Add(__pyx_1, __pyx_6); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 190; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_2 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 190; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      (__pyx_v_ttn[__pyx_v_i]) = __pyx_2;
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":192 */
      (__pyx_v_spike[__pyx_v_i]) = 0;
    }
    __pyx_L7:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("simutils.Constant_Fixed_update");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Constant_Poisson_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_i;
  int __pyx_v_qty;
  double __pyx_v_rate;
  double __pyx_v_dt;
  char (*__pyx_v_spike);
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  double __pyx_2;
  int __pyx_3;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":199 */
  __pyx_v_qty = __pyx_v_s->quantity;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":203 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_rate); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 203; goto __pyx_L1;}
  __pyx_2 = PyFloat_AsDouble(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 203; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_rate = __pyx_2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":204 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":207 */
  __pyx_v_spike = __pyx_v_s->spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":210 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_qty; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":211 */
    __pyx_3 = (randu() < ((__pyx_v_rate / 1000.0) / __pyx_v_dt));
    if (__pyx_3) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":212 */
      (__pyx_v_spike[__pyx_v_i]) = 1;
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":214 */
      (__pyx_v_spike[__pyx_v_i]) = 0;
    }
    __pyx_L4:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("simutils.Constant_Poisson_update");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Variable_Poisson_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_i;
  int __pyx_v_offset;
  int __pyx_v_qty;
  int __pyx_v_number_of_rates;
  double __pyx_v_dt;
  double __pyx_v_time_between_rates;
  double __pyx_v_time_to_next_rate;
  double (*__pyx_v_rate);
  char (*__pyx_v_spike);
  int __pyx_v_sequential;
  PyObject *__pyx_r;
  int __pyx_1;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":221 */
  __pyx_v_qty = __pyx_v_s->quantity;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":224 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":226 */
  __pyx_v_time_between_rates = __pyx_v_s->time_between_rates;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":227 */
  __pyx_v_time_to_next_rate = __pyx_v_s->time_to_next_rate;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":230 */
  __pyx_v_rate = __pyx_v_s->rate;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":231 */
  __pyx_v_number_of_rates = __pyx_v_s->number_of_rates;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":234 */
  __pyx_v_spike = __pyx_v_s->spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":237 */
  __pyx_v_sequential = __pyx_v_s->sequential;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":239 */
  __pyx_1 = (__pyx_v_t >= __pyx_v_time_to_next_rate);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":240 */
    __pyx_v_s->time_to_next_rate = (__pyx_v_s->time_to_next_rate + __pyx_v_s->time_between_rates);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":241 */
    __pyx_1 = __pyx_v_s->sequential;
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":242 */
      __pyx_v_s->which_rate = (__pyx_v_s->which_rate + 1);

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":243 */
      __pyx_1 = (__pyx_v_s->which_rate >= __pyx_v_number_of_rates);
      if (__pyx_1) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":244 */
        __pyx_v_s->which_rate = 0;
        goto __pyx_L4;
      }
      __pyx_L4:;
      goto __pyx_L3;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":246 */
      __pyx_v_s->which_rate = ((int )(randu() * __pyx_v_number_of_rates));
    }
    __pyx_L3:;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":249 */
  __pyx_v_offset = (__pyx_v_qty * __pyx_v_s->which_rate);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":250 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_qty; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":251 */
    __pyx_1 = (randu() < (((__pyx_v_rate[(__pyx_v_i + __pyx_v_offset)]) / 1000.0) / __pyx_v_dt));
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":252 */
      (__pyx_v_spike[__pyx_v_i]) = 1;
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":254 */
      (__pyx_v_spike[__pyx_v_i]) = 0;
    }
    __pyx_L7:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_n_adaptation_step;
static PyObject *__pyx_n_V_rest;
static PyObject *__pyx_n_tau_adaptation;

static PyObject *__pyx_f_8simutils_Integrate_and_Fire_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_n;
  int __pyx_v_c;
  int __pyx_v_cg;
  int __pyx_v_qty;
  double __pyx_v_dt;
  double (*__pyx_v_time_to_stop_refract);
  double (*__pyx_v_V);
  double (*__pyx_v_V_reset);
  int __pyx_v_number_of_connection_groups_to;
  char (*__pyx_v_old_spike);
  char (*__pyx_v_spike);
  double __pyx_v_gg_ex;
  double __pyx_v_gg_in;
  double __pyx_v_gmax;
  int __pyx_v_sign;
  double __pyx_v_tau_m;
  double __pyx_v_tau_in;
  double __pyx_v_tau_ex;
  double __pyx_v_reset_adaptation;
  double __pyx_v_t_refract;
  double __pyx_v_V_rev_exc;
  double __pyx_v_V_rev_inh;
  double __pyx_v_V_thresh;
  double __pyx_v_g_exc_max;
  double __pyx_v_g_inh_max;
  double (*__pyx_v_g);
  double (*__pyx_v_weights);
  double __pyx_v_sum;
  int __pyx_v_num_incell;
  int __pyx_v_num_outcell;
  int __pyx_v_ni;
  int __pyx_v_no;
  PyObject *__pyx_r;
  int __pyx_1;
  char __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  double __pyx_6;
  int __pyx_7;
  PyObject *__pyx_8 = 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":261 */
  __pyx_v_qty = __pyx_v_s->quantity;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":264 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":268 */
  __pyx_v_time_to_stop_refract = __pyx_v_s->time_to_stop_refract;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":269 */
  __pyx_v_V = __pyx_v_s->V;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":270 */
  __pyx_v_V_reset = __pyx_v_s->V_reset;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":273 */
  __pyx_v_number_of_connection_groups_to = __pyx_v_s->number_of_connection_groups_to;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":276 */
  __pyx_v_spike = __pyx_v_s->spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":282 */
  __pyx_v_tau_m = __pyx_v_s->tau_m;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":283 */
  __pyx_v_tau_ex = __pyx_v_s->tau_ex;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":284 */
  __pyx_v_tau_in = __pyx_v_s->tau_in;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":285 */
  __pyx_v_reset_adaptation = __pyx_v_s->reset_adaptation;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":286 */
  __pyx_v_t_refract = __pyx_v_s->t_refract;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":291 */
  __pyx_v_V_rev_exc = __pyx_v_s->V_rev_exc;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":292 */
  __pyx_v_V_rev_inh = __pyx_v_s->V_rev_inh;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":293 */
  __pyx_v_V_thresh = __pyx_v_s->V_thresh;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":297 */
  __pyx_v_g_exc_max = __pyx_v_s->g_exc_max;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":298 */
  __pyx_v_g_inh_max = __pyx_v_s->g_inh_max;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":304 */
  __pyx_v_gg_ex = 0.0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":305 */
  __pyx_v_gg_in = 0.0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":306 */
  for (__pyx_v_cg = 0; __pyx_v_cg < __pyx_v_number_of_connection_groups_to; ++__pyx_v_cg) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":307 */
    __pyx_v_old_spike = (__pyx_v_s->c_old_spike[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":308 */
    __pyx_v_num_incell = (__pyx_v_s->c_num_incell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":309 */
    __pyx_v_num_outcell = (__pyx_v_s->c_num_outcell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":311 */
    __pyx_v_sign = (__pyx_v_s->c_sign[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":312 */
    __pyx_v_g = (__pyx_v_s->c_g[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":313 */
    __pyx_v_weights = (__pyx_v_s->c_weights[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":316 */
    __pyx_1 = (__pyx_v_sign > 0);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":317 */
      __pyx_v_gmax = __pyx_v_g_exc_max;
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":319 */
      __pyx_v_gmax = __pyx_v_g_inh_max;
    }
    __pyx_L4:;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":321 */
    for (__pyx_v_ni = 0; __pyx_v_ni < __pyx_v_num_incell; ++__pyx_v_ni) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":322 */
      __pyx_2 = (__pyx_v_old_spike[__pyx_v_ni]);
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":323 */
        for (__pyx_v_no = 0; __pyx_v_no < __pyx_v_num_outcell; ++__pyx_v_no) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":324 */
          (__pyx_v_g[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))]) = ((__pyx_v_g[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))]) + (__pyx_v_gmax * (__pyx_v_weights[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))])));
        }
        goto __pyx_L7;
      }
      __pyx_L7:;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":326 */
    __pyx_v_sum = 0.0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":327 */
    __pyx_1 = (__pyx_v_num_incell * __pyx_v_num_outcell);
    for (__pyx_v_c = 0; __pyx_v_c < __pyx_1; ++__pyx_v_c) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":328 */
      __pyx_v_sum = (__pyx_v_sum + (__pyx_v_g[__pyx_v_c]));
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":330 */
    __pyx_1 = (__pyx_v_sign > 0);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":331 */
      __pyx_v_gg_ex = (__pyx_v_gg_ex + __pyx_v_sum);
      goto __pyx_L12;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":333 */
      __pyx_v_gg_in = (__pyx_v_gg_in + __pyx_v_sum);
    }
    __pyx_L12:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":337 */
  for (__pyx_v_n = 0; __pyx_v_n < __pyx_v_qty; ++__pyx_v_n) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":339 */
    __pyx_1 = ((__pyx_v_time_to_stop_refract[__pyx_v_n]) <= __pyx_v_t);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":341 */
      (__pyx_v_V[__pyx_v_n]) = ((((__pyx_v_V[__pyx_v_n]) - ((((__pyx_v_V[__pyx_v_n]) - (__pyx_v_V_reset[__pyx_v_n])) * __pyx_v_dt) / __pyx_v_tau_m)) + (((__pyx_v_dt * __pyx_v_gg_ex) * (__pyx_v_V_rev_exc - (__pyx_v_V[__pyx_v_n]))) / __pyx_v_tau_m)) + (((__pyx_v_dt * __pyx_v_gg_in) * (__pyx_v_V_rev_inh - (__pyx_v_V[__pyx_v_n]))) / __pyx_v_tau_m));
      goto __pyx_L15;
    }
    __pyx_L15:;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":344 */
    __pyx_1 = ((__pyx_v_V[__pyx_v_n]) > __pyx_v_V_thresh);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":345 */
      (__pyx_v_spike[__pyx_v_n]) = 1;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":346 */
      __pyx_1 = (__pyx_v_reset_adaptation != 0);
      if (__pyx_1) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":347 */
        __pyx_3 = PyFloat_FromDouble((__pyx_v_V_reset[__pyx_v_n])); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
        __pyx_4 = __Pyx_GetName(__pyx_b, __pyx_n_adaptation_step); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
        __pyx_5 = PyNumber_Subtract(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __pyx_6 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 347; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        (__pyx_v_V_reset[__pyx_v_n]) = __pyx_6;
        goto __pyx_L17;
      }
      __pyx_L17:;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":348 */
      (__pyx_v_V[__pyx_v_n]) = (__pyx_v_V_reset[__pyx_v_n]);

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":349 */
      (__pyx_v_time_to_stop_refract[__pyx_v_n]) = ((__pyx_v_time_to_stop_refract[__pyx_v_n]) + __pyx_v_t_refract);
      goto __pyx_L16;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":351 */
      (__pyx_v_spike[__pyx_v_n]) = 0;
    }
    __pyx_L16:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":355 */
  for (__pyx_v_cg = 0; __pyx_v_cg < __pyx_v_number_of_connection_groups_to; ++__pyx_v_cg) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":356 */
    __pyx_v_num_incell = (__pyx_v_s->c_num_incell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":357 */
    __pyx_v_num_outcell = (__pyx_v_s->c_num_outcell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":359 */
    __pyx_v_sign = (__pyx_v_s->c_sign[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":360 */
    __pyx_v_g = (__pyx_v_s->c_g[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":362 */
    __pyx_1 = (__pyx_v_num_incell * __pyx_v_num_outcell);
    for (__pyx_v_c = 0; __pyx_v_c < __pyx_1; ++__pyx_v_c) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":363 */
      __pyx_7 = (__pyx_v_sign > 0);
      if (__pyx_7) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":364 */
        (__pyx_v_g[__pyx_v_c]) = ((__pyx_v_g[__pyx_v_c]) - (((__pyx_v_g[__pyx_v_c]) * __pyx_v_dt) / __pyx_v_tau_ex));
        goto __pyx_L22;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":366 */
        (__pyx_v_g[__pyx_v_c]) = ((__pyx_v_g[__pyx_v_c]) - (((__pyx_v_g[__pyx_v_c]) * __pyx_v_dt) / __pyx_v_tau_in));
      }
      __pyx_L22:;
    }
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":369 */
  __pyx_7 = (__pyx_v_reset_adaptation != 0);
  if (__pyx_7) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":370 */
    for (__pyx_v_n = 0; __pyx_v_n < __pyx_v_qty; ++__pyx_v_n) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":371 */
      __pyx_2 = (__pyx_v_spike[__pyx_v_n]);
      if (__pyx_2) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":372 */
        __pyx_3 = PyFloat_FromDouble((__pyx_v_V_reset[__pyx_v_n])); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        __pyx_4 = PyFloat_FromDouble((__pyx_v_V_reset[__pyx_v_n])); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        __pyx_5 = __Pyx_GetName(__pyx_b, __pyx_n_V_rest); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        __pyx_8 = PyNumber_Subtract(__pyx_4, __pyx_5); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __pyx_4 = PyFloat_FromDouble(__pyx_v_dt); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        __pyx_5 = PyNumber_Multiply(__pyx_8, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __pyx_8 = __Pyx_GetName(__pyx_b, __pyx_n_tau_adaptation); if (!__pyx_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        __pyx_4 = PyNumber_Divide(__pyx_5, __pyx_8); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        __pyx_5 = PyNumber_Subtract(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __pyx_6 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 372; goto __pyx_L1;}
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        (__pyx_v_V_reset[__pyx_v_n]) = __pyx_6;
        goto __pyx_L26;
      }
      __pyx_L26:;
    }
    goto __pyx_L23;
  }
  __pyx_L23:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("simutils.Integrate_and_Fire_update");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Stochastic_Rate_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_n;
  int __pyx_v_c;
  int __pyx_v_cg;
  int __pyx_v_number_of_connection_groups_to;
  char (*__pyx_v_old_spike);
  char (*__pyx_v_spike);
  double (*__pyx_v_y);
  int __pyx_v_sign;
  double (*__pyx_v_g);
  double (*__pyx_v_weights);
  double __pyx_v_sum;
  int __pyx_v_num_incell;
  int __pyx_v_num_outcell;
  int __pyx_v_ni;
  int __pyx_v_no;
  double __pyx_v_dt;
  int __pyx_v_qty;
  double __pyx_v_activation_magnitude;
  double __pyx_v_tau_activation;
  PyObject *__pyx_r;
  char __pyx_1;
  int __pyx_2;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":379 */
  __pyx_v_number_of_connection_groups_to = __pyx_v_s->number_of_connection_groups_to;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":382 */
  __pyx_v_spike = __pyx_v_s->spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":386 */
  __pyx_v_y = __pyx_v_s->y;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":394 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":397 */
  __pyx_v_qty = __pyx_v_s->quantity;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":400 */
  __pyx_v_activation_magnitude = __pyx_v_s->activation_magnitude;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":401 */
  __pyx_v_tau_activation = __pyx_v_s->tau_activation;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":403 */
  for (__pyx_v_cg = 0; __pyx_v_cg < __pyx_v_number_of_connection_groups_to; ++__pyx_v_cg) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":404 */
    __pyx_v_old_spike = (__pyx_v_s->c_old_spike[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":405 */
    __pyx_v_num_incell = (__pyx_v_s->c_num_incell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":406 */
    __pyx_v_num_outcell = (__pyx_v_s->c_num_outcell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":408 */
    __pyx_v_sign = (__pyx_v_s->c_sign[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":409 */
    __pyx_v_g = (__pyx_v_s->c_g[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":410 */
    __pyx_v_weights = (__pyx_v_s->c_weights[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":412 */
    for (__pyx_v_ni = 0; __pyx_v_ni < __pyx_v_num_incell; ++__pyx_v_ni) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":413 */
      __pyx_1 = (__pyx_v_old_spike[__pyx_v_ni]);
      if (__pyx_1) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":414 */
        for (__pyx_v_no = 0; __pyx_v_no < __pyx_v_num_outcell; ++__pyx_v_no) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":415 */
          (__pyx_v_g[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))]) = ((__pyx_v_g[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))]) + ((__pyx_v_activation_magnitude * (__pyx_v_weights[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))])) * __pyx_v_sign));
        }
        goto __pyx_L6;
      }
      __pyx_L6:;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":417 */
    for (__pyx_v_no = 0; __pyx_v_no < __pyx_v_num_outcell; ++__pyx_v_no) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":418 */
      __pyx_v_sum = 0.0;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":419 */
      for (__pyx_v_ni = 0; __pyx_v_ni < __pyx_v_num_incell; ++__pyx_v_ni) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":420 */
        __pyx_v_sum = (__pyx_v_sum + (__pyx_v_g[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))]));
      }

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":422 */
      (__pyx_v_y[__pyx_v_no]) = ((__pyx_v_y[__pyx_v_no]) + (((1.0 / __pyx_v_tau_activation) * (__pyx_v_sum - (__pyx_v_y[__pyx_v_no]))) * __pyx_v_dt));
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":426 */
    __pyx_2 = (__pyx_v_num_incell * __pyx_v_num_outcell);
    for (__pyx_v_c = 0; __pyx_v_c < __pyx_2; ++__pyx_v_c) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":427 */
      (__pyx_v_g[__pyx_v_c]) = ((__pyx_v_g[__pyx_v_c]) - (((__pyx_v_g[__pyx_v_c]) * __pyx_v_dt) / __pyx_v_tau_activation));
    }
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":431 */
  for (__pyx_v_n = 0; __pyx_v_n < __pyx_v_qty; ++__pyx_v_n) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":432 */
    __pyx_2 = (randu() < (((__pyx_v_y[__pyx_v_n]) / 1000.0) / __pyx_v_dt));
    if (__pyx_2) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":433 */
      (__pyx_v_spike[__pyx_v_n]) = 1;
      goto __pyx_L17;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":435 */
      (__pyx_v_spike[__pyx_v_n]) = 0;
    }
    __pyx_L17:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_n_pattern;

static PyObject *__pyx_f_8simutils_Spike_Pattern_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_i;
  int __pyx_v_qty;
  double __pyx_v_rate;
  double __pyx_v_dt;
  double (*__pyx_v_ttn);
  char (*__pyx_v_spike);
  int (*__pyx_v_pattern_count);
  int (*__pyx_v_pattern_length);
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  double __pyx_6;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":443 */
  __pyx_v_qty = __pyx_v_s->quantity;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":446 */
  __pyx_v_rate = __pyx_v_s->rate_val;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":449 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":452 */
  __pyx_v_ttn = __pyx_v_s->time_to_next_spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":456 */
  __pyx_v_spike = __pyx_v_s->spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":459 */
  __pyx_v_pattern_count = __pyx_v_s->pattern_count;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":460 */
  __pyx_v_pattern_length = __pyx_v_s->pattern_length;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":462 */
  __pyx_1 = (__pyx_v_t >= __pyx_v_s->time_to_next_pattern);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":463 */
    __pyx_v_s->time_for_last_pattern = __pyx_v_t;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":464 */
    __pyx_2 = PyFloat_FromDouble(__pyx_v_s->time_to_next_pattern); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
    __pyx_3 = PyFloat_FromDouble((1000 * __pyx_v_dt)); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
    __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_rate); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
    __pyx_5 = PyNumber_Divide(__pyx_3, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_3 = PyNumber_Add(__pyx_2, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_6 = PyFloat_AsDouble(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 464; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_v_s->time_to_next_pattern = __pyx_6;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":465 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_qty; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":466 */
      __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_pattern); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      __pyx_2 = PyInt_FromLong(__pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      __pyx_5 = PyObject_GetItem(__pyx_4, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_3 = PyInt_FromLong(0); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      __pyx_4 = PyObject_GetItem(__pyx_5, __pyx_3); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_2 = PyFloat_FromDouble(__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      __pyx_5 = PyNumber_Add(__pyx_4, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_6 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 466; goto __pyx_L1;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      (__pyx_v_ttn[__pyx_v_i]) = __pyx_6;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":467 */
      (__pyx_v_pattern_count[__pyx_v_i]) = 0;
    }
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":469 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_qty; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":470 */
    __pyx_1 = (__pyx_v_t >= (__pyx_v_ttn[__pyx_v_i]));
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":471 */
      (__pyx_v_spike[__pyx_v_i]) = 1;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":473 */
      (__pyx_v_pattern_count[__pyx_v_i]) = ((__pyx_v_pattern_count[__pyx_v_i]) + 1);

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":474 */
      __pyx_1 = ((__pyx_v_pattern_count[__pyx_v_i]) == (__pyx_v_pattern_length[__pyx_v_i]));
      if (__pyx_1) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":475 */
        (__pyx_v_ttn[__pyx_v_i]) = 1e500;
        goto __pyx_L8;
      }
      /*else*/ {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":477 */
        __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_pattern); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        __pyx_4 = PyInt_FromLong(__pyx_v_i); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        __pyx_2 = PyObject_GetItem(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __pyx_5 = PyInt_FromLong((__pyx_v_pattern_count[__pyx_v_i])); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        __pyx_3 = PyObject_GetItem(__pyx_2, __pyx_5); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_5); __pyx_5 = 0;
        __pyx_4 = PyFloat_FromDouble(__pyx_v_s->time_for_last_pattern); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        __pyx_2 = PyNumber_Add(__pyx_3, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        __pyx_6 = PyFloat_AsDouble(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 477; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        (__pyx_v_ttn[__pyx_v_i]) = __pyx_6;
      }
      __pyx_L8:;
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":479 */
      (__pyx_v_spike[__pyx_v_i]) = 0;
    }
    __pyx_L7:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("simutils.Spike_Pattern_update");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_f_8simutils_Izh_update(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  int __pyx_v_n;
  int __pyx_v_cg;
  int __pyx_v_qty;
  double __pyx_v_dt;
  double (*__pyx_v_V);
  double (*__pyx_v_u);
  double (*__pyx_v_epsp1);
  double (*__pyx_v_epsp2);
  double (*__pyx_v_ipsp1);
  double (*__pyx_v_ipsp2);
  int __pyx_v_number_of_connection_groups_to;
  double __pyx_v_a;
  double __pyx_v_b;
  double __pyx_v_d;
  double __pyx_v_I;
  double __pyx_v_V_reset;
  char (*__pyx_v_old_spike);
  char (*__pyx_v_spike);
  PyObject *__pyx_v_epsp_scale;
  int __pyx_v_sign;
  double __pyx_v_V_peak;
  double __pyx_v_g_exc_max;
  double __pyx_v_g_inh_max;
  double (*__pyx_v_weights);
  int __pyx_v_num_incell;
  int __pyx_v_num_outcell;
  int __pyx_v_ni;
  int __pyx_v_no;
  PyObject *__pyx_v_gg_ex;
  PyObject *__pyx_v_gg_in;
  double __pyx_v_tm;
  double __pyx_v_norm_const;
  double __pyx_v_w;
  double __pyx_v_tau_epsp1;
  double __pyx_v_tau_epsp2;
  PyObject *__pyx_r;
  char __pyx_1;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  double __pyx_7;
  Py_INCREF(__pyx_v_self);
  __pyx_v_epsp_scale = Py_None; Py_INCREF(Py_None);
  __pyx_v_gg_ex = Py_None; Py_INCREF(Py_None);
  __pyx_v_gg_in = Py_None; Py_INCREF(Py_None);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":485 */
  __pyx_v_qty = __pyx_v_s->quantity;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":488 */
  __pyx_v_dt = __pyx_v_s->dt;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":492 */
  __pyx_v_V = __pyx_v_s->V;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":493 */
  __pyx_v_u = __pyx_v_s->u;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":494 */
  __pyx_v_epsp1 = __pyx_v_s->epsp1;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":495 */
  __pyx_v_epsp2 = __pyx_v_s->epsp2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":496 */
  __pyx_v_ipsp1 = __pyx_v_s->ipsp1;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":497 */
  __pyx_v_ipsp2 = __pyx_v_s->ipsp2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":500 */
  __pyx_v_number_of_connection_groups_to = __pyx_v_s->number_of_connection_groups_to;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":503 */
  __pyx_v_a = __pyx_v_s->a;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":504 */
  __pyx_v_b = __pyx_v_s->b;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":505 */
  __pyx_v_V_reset = __pyx_v_s->c;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":506 */
  __pyx_v_d = __pyx_v_s->d;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":507 */
  __pyx_v_I = __pyx_v_s->I;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":510 */
  __pyx_v_spike = __pyx_v_s->spike;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":512 */
  for (__pyx_v_n = 0; __pyx_v_n < __pyx_v_qty; ++__pyx_v_n) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":513 */
    __pyx_1 = (__pyx_v_spike[__pyx_v_n]);
    if (__pyx_1) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":514 */
      (__pyx_v_V[__pyx_v_n]) = __pyx_v_V_reset;
      goto __pyx_L4;
    }
    __pyx_L4:;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":519 */
  __pyx_2 = PyFloat_FromDouble(__pyx_v_s->epsp_scale); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 519; goto __pyx_L1;}
  Py_DECREF(__pyx_v_epsp_scale);
  __pyx_v_epsp_scale = __pyx_2;
  __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":522 */
  __pyx_v_V_peak = __pyx_v_s->V_peak;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":525 */
  __pyx_v_g_exc_max = __pyx_v_s->g_exc_max;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":526 */
  __pyx_v_g_inh_max = __pyx_v_s->g_inh_max;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":532 */
  __pyx_2 = PyFloat_FromDouble(0.0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 532; goto __pyx_L1;}
  Py_DECREF(__pyx_v_gg_ex);
  __pyx_v_gg_ex = __pyx_2;
  __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":533 */
  __pyx_2 = PyFloat_FromDouble(0.0); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 533; goto __pyx_L1;}
  Py_DECREF(__pyx_v_gg_in);
  __pyx_v_gg_in = __pyx_2;
  __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":538 */
  __pyx_v_tau_epsp1 = __pyx_v_s->tau_epsp1;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":539 */
  __pyx_v_tau_epsp2 = __pyx_v_s->tau_epsp2;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":541 */
  __pyx_v_tm = ((log(__pyx_v_tau_epsp2) - log(__pyx_v_tau_epsp1)) / ((1.0 / __pyx_v_tau_epsp1) - (1.0 / __pyx_v_tau_epsp2)));

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":542 */
  __pyx_v_norm_const = (exp(((-__pyx_v_tm) / __pyx_v_tau_epsp1)) - exp(((-__pyx_v_tm) / __pyx_v_tau_epsp2)));

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":546 */
  for (__pyx_v_n = 0; __pyx_v_n < __pyx_v_qty; ++__pyx_v_n) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":548 */
    (__pyx_v_epsp1[__pyx_v_n]) = ((__pyx_v_epsp1[__pyx_v_n]) - (((__pyx_v_epsp1[__pyx_v_n]) * __pyx_v_dt) / __pyx_v_tau_epsp1));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":549 */
    (__pyx_v_epsp2[__pyx_v_n]) = ((__pyx_v_epsp2[__pyx_v_n]) - (((__pyx_v_epsp2[__pyx_v_n]) * __pyx_v_dt) / __pyx_v_tau_epsp2));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":551 */
    (__pyx_v_ipsp1[__pyx_v_n]) = ((__pyx_v_ipsp1[__pyx_v_n]) - (((__pyx_v_ipsp1[__pyx_v_n]) * __pyx_v_dt) / __pyx_v_tau_epsp1));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":552 */
    (__pyx_v_ipsp2[__pyx_v_n]) = ((__pyx_v_ipsp2[__pyx_v_n]) - (((__pyx_v_ipsp2[__pyx_v_n]) * __pyx_v_dt) / __pyx_v_tau_epsp2));
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":554 */
  for (__pyx_v_cg = 0; __pyx_v_cg < __pyx_v_number_of_connection_groups_to; ++__pyx_v_cg) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":556 */
    __pyx_v_old_spike = (__pyx_v_s->c_old_spike[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":557 */
    __pyx_v_num_incell = (__pyx_v_s->c_num_incell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":558 */
    __pyx_v_num_outcell = (__pyx_v_s->c_num_outcell[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":560 */
    __pyx_v_sign = (__pyx_v_s->c_sign[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":561 */
    __pyx_v_weights = (__pyx_v_s->c_weights[__pyx_v_cg]);

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":563 */
    for (__pyx_v_ni = 0; __pyx_v_ni < __pyx_v_num_incell; ++__pyx_v_ni) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":564 */
      __pyx_1 = (__pyx_v_old_spike[__pyx_v_ni]);
      if (__pyx_1) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":566 */
        __pyx_v_w = (__pyx_v_weights[(__pyx_v_no + (__pyx_v_ni * __pyx_v_num_outcell))]);

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":567 */
        __pyx_3 = (__pyx_v_sign > 0);
        if (__pyx_3) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":568 */
          for (__pyx_v_no = 0; __pyx_v_no < __pyx_v_num_outcell; ++__pyx_v_no) {

            /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":569 */
            __pyx_2 = PyFloat_FromDouble((__pyx_v_epsp1[__pyx_v_no])); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 569; goto __pyx_L1;}
            __pyx_4 = PyFloat_FromDouble(__pyx_v_w); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 569; goto __pyx_L1;}
            __pyx_5 = PyNumber_Multiply(__pyx_v_epsp_scale, __pyx_4); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 569; goto __pyx_L1;}
            Py_DECREF(__pyx_4); __pyx_4 = 0;
            __pyx_4 = PyFloat_FromDouble(__pyx_v_norm_const); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 569; goto __pyx_L1;}
            __pyx_6 = PyNumber_Divide(__pyx_5, __pyx_4); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 569; goto __pyx_L1;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            Py_DECREF(__pyx_4); __pyx_4 = 0;
            __pyx_5 = PyNumber_Add(__pyx_2, __pyx_6); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 569; goto __pyx_L1;}
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            __pyx_7 = PyFloat_AsDouble(__pyx_5); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 569; goto __pyx_L1;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            (__pyx_v_epsp1[__pyx_v_no]) = __pyx_7;

            /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":570 */
            __pyx_4 = PyFloat_FromDouble((__pyx_v_epsp2[__pyx_v_no])); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 570; goto __pyx_L1;}
            __pyx_2 = PyFloat_FromDouble(__pyx_v_w); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 570; goto __pyx_L1;}
            __pyx_6 = PyNumber_Multiply(__pyx_v_epsp_scale, __pyx_2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 570; goto __pyx_L1;}
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            __pyx_5 = PyFloat_FromDouble(__pyx_v_norm_const); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 570; goto __pyx_L1;}
            __pyx_2 = PyNumber_Divide(__pyx_6, __pyx_5); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 570; goto __pyx_L1;}
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            __pyx_6 = PyNumber_Add(__pyx_4, __pyx_2); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 570; goto __pyx_L1;}
            Py_DECREF(__pyx_4); __pyx_4 = 0;
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            __pyx_7 = PyFloat_AsDouble(__pyx_6); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 570; goto __pyx_L1;}
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            (__pyx_v_epsp2[__pyx_v_no]) = __pyx_7;
          }
          goto __pyx_L12;
        }
        /*else*/ {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":572 */
          for (__pyx_v_no = 0; __pyx_v_no < __pyx_v_num_outcell; ++__pyx_v_no) {

            /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":573 */
            __pyx_5 = PyFloat_FromDouble((__pyx_v_ipsp1[__pyx_v_no])); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; goto __pyx_L1;}
            __pyx_4 = PyFloat_FromDouble(__pyx_v_w); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; goto __pyx_L1;}
            __pyx_2 = PyNumber_Multiply(__pyx_v_epsp_scale, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; goto __pyx_L1;}
            Py_DECREF(__pyx_4); __pyx_4 = 0;
            __pyx_6 = PyFloat_FromDouble(__pyx_v_norm_const); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; goto __pyx_L1;}
            __pyx_4 = PyNumber_Divide(__pyx_2, __pyx_6); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; goto __pyx_L1;}
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            __pyx_2 = PyNumber_Add(__pyx_5, __pyx_4); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; goto __pyx_L1;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            Py_DECREF(__pyx_4); __pyx_4 = 0;
            __pyx_7 = PyFloat_AsDouble(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 573; goto __pyx_L1;}
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            (__pyx_v_ipsp1[__pyx_v_no]) = __pyx_7;

            /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":574 */
            __pyx_6 = PyFloat_FromDouble((__pyx_v_ipsp2[__pyx_v_no])); if (!__pyx_6) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; goto __pyx_L1;}
            __pyx_5 = PyFloat_FromDouble(__pyx_v_w); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; goto __pyx_L1;}
            __pyx_4 = PyNumber_Multiply(__pyx_v_epsp_scale, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; goto __pyx_L1;}
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            __pyx_2 = PyFloat_FromDouble(__pyx_v_norm_const); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; goto __pyx_L1;}
            __pyx_5 = PyNumber_Divide(__pyx_4, __pyx_2); if (!__pyx_5) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; goto __pyx_L1;}
            Py_DECREF(__pyx_4); __pyx_4 = 0;
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            __pyx_4 = PyNumber_Add(__pyx_6, __pyx_5); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; goto __pyx_L1;}
            Py_DECREF(__pyx_6); __pyx_6 = 0;
            Py_DECREF(__pyx_5); __pyx_5 = 0;
            __pyx_7 = PyFloat_AsDouble(__pyx_4); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 574; goto __pyx_L1;}
            Py_DECREF(__pyx_4); __pyx_4 = 0;
            (__pyx_v_ipsp2[__pyx_v_no]) = __pyx_7;
          }
        }
        __pyx_L12:;
        goto __pyx_L11;
      }
      __pyx_L11:;
    }
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":577 */
  for (__pyx_v_n = 0; __pyx_v_n < __pyx_v_qty; ++__pyx_v_n) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":579 */
    (__pyx_v_V[__pyx_v_n]) = (((__pyx_v_V[__pyx_v_n]) + ((((((0.04 * (__pyx_v_V[__pyx_v_n])) * (__pyx_v_V[__pyx_v_n])) + (5.0 * (__pyx_v_V[__pyx_v_n]))) + 140.0) - (__pyx_v_u[__pyx_v_n])) * __pyx_v_dt)) + ((((__pyx_v_epsp1[__pyx_v_n]) - (__pyx_v_epsp2[__pyx_v_n])) - ((__pyx_v_ipsp1[__pyx_v_n]) - (__pyx_v_ipsp2[__pyx_v_n]))) * __pyx_v_dt));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":583 */
    (__pyx_v_u[__pyx_v_n]) = ((__pyx_v_u[__pyx_v_n]) + ((__pyx_v_a * ((__pyx_v_b * (__pyx_v_V[__pyx_v_n])) - (__pyx_v_u[__pyx_v_n]))) * __pyx_v_dt));

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":585 */
    __pyx_3 = ((__pyx_v_V[__pyx_v_n]) > __pyx_v_V_peak);
    if (__pyx_3) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":586 */
      (__pyx_v_spike[__pyx_v_n]) = 1;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":587 */
      (__pyx_v_V[__pyx_v_n]) = __pyx_v_V_peak;
      goto __pyx_L19;
    }
    /*else*/ {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":589 */
      (__pyx_v_spike[__pyx_v_n]) = 0;
    }
    __pyx_L19:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("simutils.Izh_update");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_epsp_scale);
  Py_DECREF(__pyx_v_gg_ex);
  Py_DECREF(__pyx_v_gg_in);
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_k23p;

static char (__pyx_k23[]) = "Unknown type: %d";

static PyObject *__pyx_f_8simutils_nupdate(struct __pyx_t_8simutils_Neuron_Group_struct (*__pyx_v_s),PyObject *__pyx_v_self,double __pyx_v_t) {
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  Py_INCREF(__pyx_v_self);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":595 */
  __pyx_1 = (__pyx_v_s->type == (-1));
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":596 */
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_update); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 596; goto __pyx_L1;}
    __pyx_3 = PyFloat_FromDouble(__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 596; goto __pyx_L1;}
    __pyx_4 = PyTuple_New(1); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 596; goto __pyx_L1;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_3);
    __pyx_3 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_4); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 596; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":597 */
    __pyx_r = Py_None; Py_INCREF(Py_None);
    goto __pyx_L0;
    goto __pyx_L2;
  }
  __pyx_L2:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":599 */
  __pyx_2 = __pyx_f_8simutils_copy_spikes(__pyx_v_s); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 599; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":601 */
  __pyx_1 = (__pyx_v_s->type == 0);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":602 */
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 1);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":604 */
    __pyx_4 = __pyx_f_8simutils_Constant_Fixed_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 604; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 2);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":606 */
    __pyx_3 = __pyx_f_8simutils_Constant_Poisson_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 606; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 3);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":608 */
    __pyx_2 = __pyx_f_8simutils_Variable_Poisson_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 608; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 4);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":610 */
    __pyx_4 = __pyx_f_8simutils_Integrate_and_Fire_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 610; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 5);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":612 */
    __pyx_3 = __pyx_f_8simutils_Stochastic_Rate_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 612; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 6);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":614 */
    __pyx_2 = __pyx_f_8simutils_Spike_Pattern_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 614; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    goto __pyx_L3;
  }
  __pyx_1 = (__pyx_v_s->type == 7);
  if (__pyx_1) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":616 */
    __pyx_4 = __pyx_f_8simutils_Izh_update(__pyx_v_s,__pyx_v_self,__pyx_v_t); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 616; goto __pyx_L1;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/c_neuron_groups.pyx":618 */
    __pyx_3 = __Pyx_GetName(__pyx_b, __pyx_n_TypeError); if (!__pyx_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 618; goto __pyx_L1;}
    __pyx_2 = PyInt_FromLong(__pyx_v_s->type); if (!__pyx_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 618; goto __pyx_L1;}
    __pyx_4 = PyNumber_Remainder(__pyx_k23p, __pyx_2); if (!__pyx_4) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 618; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_Raise(__pyx_3, __pyx_4, 0);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 618; goto __pyx_L1;}
  }
  __pyx_L3:;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("simutils.nupdate");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_self);
  return __pyx_r;
}

static PyObject *__pyx_n_False;
static PyObject *__pyx_n_total_time;
static PyObject *__pyx_n__reset_;
static PyObject *__pyx_n_hash_step;
static PyObject *__pyx_n_display_step;
static PyObject *__pyx_n_display_hash;
static PyObject *__pyx_n_times_to_save;
static PyObject *__pyx_n_save;
static PyObject *__pyx_n_save_sim_file;
static PyObject *__pyx_n_stdout;
static PyObject *__pyx_n_flush;
static PyObject *__pyx_n_save_sim;
static PyObject *__pyx_n_display;
static PyObject *__pyx_n_updated;
static PyObject *__pyx_n_float;

static PyObject *__pyx_k30p;
static PyObject *__pyx_k32p;
static PyObject *__pyx_k33p;
static PyObject *__pyx_k36p;
static PyObject *__pyx_k38p;
static PyObject *__pyx_k39p;
static PyObject *__pyx_k40p;
static PyObject *__pyx_k42p;
static PyObject *__pyx_k43p;

static char (__pyx_k30[]) = "Preemptive save of ";
static char (__pyx_k32[]) = "...";
static char (__pyx_k33[]) = "done.";
static char (__pyx_k36[]) = "Preemptive save of ";
static char (__pyx_k38[]) = "...";
static char (__pyx_k39[]) = "done.";
static char (__pyx_k40[]) = "Preemptive save of ";
static char (__pyx_k42[]) = "...";
static char (__pyx_k43[]) = "done.";

static PyObject *__pyx_f_8simutils_run_sim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8simutils_run_sim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_sim_params = 0;
  PyObject *__pyx_v_n_list = 0;
  PyObject *__pyx_v_c_list = 0;
  int __pyx_v_time_to_save;
  PyObject *__pyx_v_wb;
  PY_LONG_LONG __pyx_v_t;
  int __pyx_v_i;
  int __pyx_v_ln;
  int __pyx_v_lc;
  PY_LONG_LONG __pyx_v_num_iter;
  PY_LONG_LONG __pyx_v_hash_step;
  PY_LONG_LONG __pyx_v_display_step;
  int __pyx_v_display_hash;
  int __pyx_v_save_count;
  int __pyx_v_max_save_count;
  double (*__pyx_v_times_to_savep);
  struct __pyx_t_8simutils_Connection_Group_struct (__pyx_v_Sc[31]);
  struct __pyx_t_8simutils_Neuron_Group_struct (__pyx_v_Sn[31]);
  PyObject *__pyx_v_t1;
  PyObject *__pyx_v_t2;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PY_LONG_LONG __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"sim_params","n_list","c_list",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOO", __pyx_argnames, &__pyx_v_sim_params, &__pyx_v_n_list, &__pyx_v_c_list)) return 0;
  Py_INCREF(__pyx_v_sim_params);
  Py_INCREF(__pyx_v_n_list);
  Py_INCREF(__pyx_v_c_list);
  __pyx_v_wb = Py_None; Py_INCREF(Py_None);
  __pyx_v_t1 = Py_None; Py_INCREF(Py_None);
  __pyx_v_t2 = Py_None; Py_INCREF(Py_None);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":17 */
  __pyx_v_time_to_save = ((60 * 60) * 24);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":19 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_Waitbar); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 19; goto __pyx_L1;}
  __pyx_2 = __Pyx_GetName(__pyx_b, __pyx_n_False); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 19; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 19; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 19; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_v_wb);
  __pyx_v_wb = __pyx_2;
  __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":26 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_len); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 26; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 26; goto __pyx_L1;}
  Py_INCREF(__pyx_v_n_list);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_n_list);
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 26; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 26; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_ln = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":27 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_len); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 27; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 27; goto __pyx_L1;}
  Py_INCREF(__pyx_v_c_list);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_c_list);
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 27; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 27; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_lc = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":31 */
  __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_total_time); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 31; goto __pyx_L1;}
  __pyx_5 = PyInt_AsUnsignedLongLongMask(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 31; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_num_iter = __pyx_5;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":34 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":35 */
    __pyx_3 = PyInt_FromLong(__pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 35; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_n_list, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 35; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n__reset_); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 35; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 35; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":36 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_lc; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":37 */
    __pyx_2 = PyInt_FromLong(__pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 37; goto __pyx_L1;}
    __pyx_1 = PyObject_GetItem(__pyx_v_c_list, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 37; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_n__reset_); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 37; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_2 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 37; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":40 */
  __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_hash_step); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 40; goto __pyx_L1;}
  __pyx_5 = PyInt_AsUnsignedLongLongMask(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 40; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_hash_step = __pyx_5;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":43 */
  __pyx_3 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display_step); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 43; goto __pyx_L1;}
  __pyx_5 = PyInt_AsUnsignedLongLongMask(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 43; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_v_display_step = __pyx_5;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":46 */
  __pyx_2 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display_hash); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 46; goto __pyx_L1;}
  __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 46; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_display_hash = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":51 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_len); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; goto __pyx_L1;}
  __pyx_3 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_times_to_save); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; goto __pyx_L1;}
  __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_4 = PyInt_AsLong(__pyx_3); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_v_max_save_count = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":52 */
  __pyx_v_save_count = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":54 */
  __pyx_4 = (__pyx_v_max_save_count > 0);
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":55 */
    __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_times_to_save); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 55; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_1, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 55; goto __pyx_L1;}
    __pyx_v_times_to_savep = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_1));
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":57 */
    __pyx_v_times_to_savep = NULL;
  }
  __pyx_L6:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":61 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_lc; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":62 */
    __pyx_2 = PyInt_FromLong(__pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 62; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_v_c_list, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 62; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    (__pyx_v_Sc[__pyx_v_i]) = __pyx_f_8simutils_init_Connection_Group(__pyx_3);
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":64 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":65 */
    __pyx_1 = PyInt_FromLong(__pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 65; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_n_list, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 65; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    (__pyx_v_Sn[__pyx_v_i]) = __pyx_f_8simutils_init_Neuron_Group(__pyx_2);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":67 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_time); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 67; goto __pyx_L1;}
  __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_time); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 67; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 67; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_t1);
  __pyx_v_t1 = __pyx_2;
  __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":68 */
  for (__pyx_v_t = 0; __pyx_v_t < __pyx_v_num_iter; ++__pyx_v_t) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":71 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":72 */
      __pyx_3 = PyInt_FromLong(__pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 72; goto __pyx_L1;}
      __pyx_1 = PyObject_GetItem(__pyx_v_n_list, __pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 72; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_2 = __pyx_f_8simutils_nupdate((&(__pyx_v_Sn[__pyx_v_i])),__pyx_1,__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 72; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":74 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_lc; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":75 */
      __pyx_3 = PyInt_FromLong(__pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 75; goto __pyx_L1;}
      __pyx_1 = PyObject_GetItem(__pyx_v_c_list, __pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 75; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_2 = __pyx_f_8simutils_cupdate((&(__pyx_v_Sc[__pyx_v_i])),__pyx_1,__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 75; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":76 */
      __pyx_3 = __pyx_f_8simutils_saturate((&(__pyx_v_Sc[__pyx_v_i]))); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 76; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":79 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":80 */
      __pyx_1 = PyInt_FromLong(__pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 80; goto __pyx_L1;}
      __pyx_2 = PyObject_GetItem(__pyx_v_n_list, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 80; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_3 = __pyx_f_8simutils_save_spikes((&(__pyx_v_Sn[__pyx_v_i])),__pyx_2,__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 80; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":82 */
    __pyx_4 = (__pyx_v_save_count < __pyx_v_max_save_count);
    if (__pyx_4) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":83 */
      __pyx_4 = (__pyx_v_t >= (__pyx_v_times_to_savep[__pyx_v_save_count]));
      if (__pyx_4) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":84 */
        for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":85 */
          __pyx_1 = PyInt_FromLong(__pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
          __pyx_2 = PyObject_GetItem(__pyx_v_n_list, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_save); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_1 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
          __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
          __pyx_1 = 0;
          __pyx_1 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 85; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_1); __pyx_1 = 0;
        }

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":87 */
        for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_lc; ++__pyx_v_i) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":88 */
          __pyx_3 = PyInt_FromLong(__pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
          __pyx_2 = PyObject_GetItem(__pyx_v_c_list, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_save); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_3 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
          __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
          __pyx_3 = 0;
          __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
        }

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":90 */
        __pyx_v_save_count = (__pyx_v_save_count + 1);

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":92 */
        __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_time); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 92; goto __pyx_L1;}
        __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_time); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 92; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 92; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_v_t2);
        __pyx_v_t2 = __pyx_3;
        __pyx_3 = 0;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":93 */
        __pyx_1 = PyNumber_Subtract(__pyx_v_t2, __pyx_v_t1); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 93; goto __pyx_L1;}
        __pyx_2 = PyInt_FromLong(__pyx_v_time_to_save); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 93; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_1, __pyx_2, &__pyx_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 93; goto __pyx_L1;}
        __pyx_4 = __pyx_4 > 0;
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        if (__pyx_4) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":94 */
          if (__Pyx_PrintItem(__pyx_k30p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 94; goto __pyx_L1;}
          __pyx_3 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_save_sim_file); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 94; goto __pyx_L1;}
          if (__Pyx_PrintItem(__pyx_3) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 94; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          if (__Pyx_PrintItem(__pyx_k32p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 94; goto __pyx_L1;}

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":95 */
          __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; goto __pyx_L1;}
          __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_stdout); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_flush); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_1); __pyx_1 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":96 */
          __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_sim); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 96; goto __pyx_L1;}
          __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_save_sim); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 96; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_1 = PyTuple_New(3); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 96; goto __pyx_L1;}
          Py_INCREF(__pyx_v_sim_params);
          PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_sim_params);
          Py_INCREF(__pyx_v_n_list);
          PyTuple_SET_ITEM(__pyx_1, 1, __pyx_v_n_list);
          Py_INCREF(__pyx_v_c_list);
          PyTuple_SET_ITEM(__pyx_1, 2, __pyx_v_c_list);
          __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 96; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":97 */
          if (__Pyx_PrintItem(__pyx_k33p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 97; goto __pyx_L1;}
          if (__Pyx_PrintNewline() < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 97; goto __pyx_L1;}

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":98 */
          __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 98; goto __pyx_L1;}
          __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_stdout); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 98; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_flush); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 98; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_3 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 98; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":99 */
          Py_INCREF(__pyx_v_t2);
          Py_DECREF(__pyx_v_t1);
          __pyx_v_t1 = __pyx_v_t2;
          goto __pyx_L25;
        }
        __pyx_L25:;
        goto __pyx_L20;
      }
      __pyx_L20:;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":103 */
      __pyx_4 = ((__pyx_v_t % __pyx_v_display_step) == 0);
      if (__pyx_4) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":104 */
        __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 104; goto __pyx_L1;}
        __pyx_4 = PyObject_IsTrue(__pyx_1); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 104; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        if (__pyx_4) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":105 */
          __pyx_2 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 105; goto __pyx_L1;}
          __pyx_3 = PyTuple_New(2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 105; goto __pyx_L1;}
          Py_INCREF(__pyx_v_n_list);
          PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_n_list);
          Py_INCREF(__pyx_v_c_list);
          PyTuple_SET_ITEM(__pyx_3, 1, __pyx_v_c_list);
          __pyx_1 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 105; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          goto __pyx_L27;
        }
        __pyx_L27:;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":106 */
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_time); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 106; goto __pyx_L1;}
        __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_time); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 106; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 106; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_v_t2);
        __pyx_v_t2 = __pyx_1;
        __pyx_1 = 0;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":107 */
        __pyx_2 = PyNumber_Subtract(__pyx_v_t2, __pyx_v_t1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 107; goto __pyx_L1;}
        __pyx_3 = PyInt_FromLong(__pyx_v_time_to_save); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 107; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_2, __pyx_3, &__pyx_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 107; goto __pyx_L1;}
        __pyx_4 = __pyx_4 > 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        if (__pyx_4) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":108 */
          if (__Pyx_PrintItem(__pyx_k36p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 108; goto __pyx_L1;}
          __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_save_sim_file); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 108; goto __pyx_L1;}
          if (__Pyx_PrintItem(__pyx_1) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 108; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          if (__Pyx_PrintItem(__pyx_k38p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 108; goto __pyx_L1;}

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":109 */
          __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; goto __pyx_L1;}
          __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_stdout); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_flush); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 109; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":110 */
          __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_sim); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 110; goto __pyx_L1;}
          __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_save_sim); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 110; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 110; goto __pyx_L1;}
          Py_INCREF(__pyx_v_sim_params);
          PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_sim_params);
          Py_INCREF(__pyx_v_n_list);
          PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_n_list);
          Py_INCREF(__pyx_v_c_list);
          PyTuple_SET_ITEM(__pyx_2, 2, __pyx_v_c_list);
          __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 110; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":111 */
          if (__Pyx_PrintItem(__pyx_k39p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 111; goto __pyx_L1;}
          if (__Pyx_PrintNewline() < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 111; goto __pyx_L1;}

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":112 */
          __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 112; goto __pyx_L1;}
          __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_stdout); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 112; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_flush); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 112; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 112; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_1); __pyx_1 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":113 */
          Py_INCREF(__pyx_v_t2);
          Py_DECREF(__pyx_v_t1);
          __pyx_v_t1 = __pyx_v_t2;
          goto __pyx_L28;
        }
        __pyx_L28:;
        goto __pyx_L26;
      }
      __pyx_L26:;
      goto __pyx_L19;
    }
    __pyx_L19:;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":116 */
    __pyx_4 = __pyx_v_display_hash;
    if (__pyx_4) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":117 */
      __pyx_4 = ((__pyx_v_t % __pyx_v_hash_step) == 0);
      if (__pyx_4) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":119 */
        __pyx_2 = PyObject_GetAttr(__pyx_v_wb, __pyx_n_updated); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        __pyx_3 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_float); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        __pyx_6 = PyLong_FromLongLong(__pyx_v_num_iter); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_6);
        __pyx_6 = 0;
        __pyx_6 = PyObject_CallObject(__pyx_1, __pyx_7); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_1 = PyNumber_Divide(__pyx_3, __pyx_6); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_1);
        __pyx_1 = 0;
        __pyx_3 = PyObject_CallObject(__pyx_2, __pyx_7); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 119; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":120 */
        __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_time); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 120; goto __pyx_L1;}
        __pyx_1 = PyObject_GetAttr(__pyx_6, __pyx_n_time); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 120; goto __pyx_L1;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 120; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        Py_DECREF(__pyx_v_t2);
        __pyx_v_t2 = __pyx_2;
        __pyx_2 = 0;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":121 */
        __pyx_7 = PyNumber_Subtract(__pyx_v_t2, __pyx_v_t1); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 121; goto __pyx_L1;}
        __pyx_3 = PyInt_FromLong(__pyx_v_time_to_save); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 121; goto __pyx_L1;}
        if (PyObject_Cmp(__pyx_7, __pyx_3, &__pyx_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 121; goto __pyx_L1;}
        __pyx_4 = __pyx_4 > 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        if (__pyx_4) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":122 */
          if (__Pyx_PrintItem(__pyx_k40p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 122; goto __pyx_L1;}
          __pyx_6 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_save_sim_file); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 122; goto __pyx_L1;}
          if (__Pyx_PrintItem(__pyx_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 122; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          if (__Pyx_PrintItem(__pyx_k42p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 122; goto __pyx_L1;}

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":123 */
          __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 123; goto __pyx_L1;}
          __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_n_stdout); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 123; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_7 = PyObject_GetAttr(__pyx_2, __pyx_n_flush); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 123; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_3 = PyObject_CallObject(__pyx_7, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 123; goto __pyx_L1;}
          Py_DECREF(__pyx_7); __pyx_7 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":124 */
          __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_n_sim); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; goto __pyx_L1;}
          __pyx_1 = PyObject_GetAttr(__pyx_6, __pyx_n_save_sim); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_2 = PyTuple_New(3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; goto __pyx_L1;}
          Py_INCREF(__pyx_v_sim_params);
          PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_sim_params);
          Py_INCREF(__pyx_v_n_list);
          PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_n_list);
          Py_INCREF(__pyx_v_c_list);
          PyTuple_SET_ITEM(__pyx_2, 2, __pyx_v_c_list);
          __pyx_7 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_7); __pyx_7 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":125 */
          if (__Pyx_PrintItem(__pyx_k43p) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 125; goto __pyx_L1;}
          if (__Pyx_PrintNewline() < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 125; goto __pyx_L1;}

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":126 */
          __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_n_sys); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; goto __pyx_L1;}
          __pyx_6 = PyObject_GetAttr(__pyx_3, __pyx_n_stdout); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_1 = PyObject_GetAttr(__pyx_6, __pyx_n_flush); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; goto __pyx_L1;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_2 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":127 */
          Py_INCREF(__pyx_v_t2);
          Py_DECREF(__pyx_v_t1);
          __pyx_v_t1 = __pyx_v_t2;
          goto __pyx_L31;
        }
        __pyx_L31:;
        goto __pyx_L30;
      }
      __pyx_L30:;
      goto __pyx_L29;
    }
    __pyx_L29:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("simutils.run_sim");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wb);
  Py_DECREF(__pyx_v_t1);
  Py_DECREF(__pyx_v_t2);
  Py_DECREF(__pyx_v_sim_params);
  Py_DECREF(__pyx_v_n_list);
  Py_DECREF(__pyx_v_c_list);
  return __pyx_r;
}

static PyObject *__pyx_n_num_display_hash;
static PyObject *__pyx_n_saturate;


static PyObject *__pyx_f_8simutils_run_sim_working(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8simutils_run_sim_working(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_sim_params = 0;
  PyObject *__pyx_v_n_list = 0;
  PyObject *__pyx_v_c_list = 0;
  PyObject *__pyx_v_wb;
  PY_LONG_LONG __pyx_v_t;
  int __pyx_v_i;
  int __pyx_v_ln;
  int __pyx_v_lc;
  PY_LONG_LONG __pyx_v_progress_step;
  PY_LONG_LONG __pyx_v_num_iter;
  int __pyx_v_display_step;
  int __pyx_v_display_hash;
  int __pyx_v_save_count;
  int __pyx_v_max_save_count;
  double (*__pyx_v_times_to_savep);
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PY_LONG_LONG __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  static char *__pyx_argnames[] = {"sim_params","n_list","c_list",0};
  if (!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOO", __pyx_argnames, &__pyx_v_sim_params, &__pyx_v_n_list, &__pyx_v_c_list)) return 0;
  Py_INCREF(__pyx_v_sim_params);
  Py_INCREF(__pyx_v_n_list);
  Py_INCREF(__pyx_v_c_list);
  __pyx_v_wb = Py_None; Py_INCREF(Py_None);

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":135 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_n_Waitbar); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; goto __pyx_L1;}
  __pyx_2 = __Pyx_GetName(__pyx_b, __pyx_n_False); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_v_wb);
  __pyx_v_wb = __pyx_2;
  __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":142 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_len); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 142; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 142; goto __pyx_L1;}
  Py_INCREF(__pyx_v_n_list);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_n_list);
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 142; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 142; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_ln = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":143 */
  __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_len); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 143; goto __pyx_L1;}
  __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 143; goto __pyx_L1;}
  Py_INCREF(__pyx_v_c_list);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_c_list);
  __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 143; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 143; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_lc = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":148 */
  __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_total_time); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 148; goto __pyx_L1;}
  __pyx_5 = PyInt_AsUnsignedLongLongMask(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 148; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_num_iter = __pyx_5;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":151 */
  __pyx_3 = PyLong_FromLongLong(__pyx_v_num_iter); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 151; goto __pyx_L1;}
  __pyx_2 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_num_display_hash); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 151; goto __pyx_L1;}
  if (PyObject_Cmp(__pyx_3, __pyx_2, &__pyx_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 151; goto __pyx_L1;}
  __pyx_4 = __pyx_4 >= 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":152 */
    __pyx_1 = PyLong_FromLongLong(__pyx_v_num_iter); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 152; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_num_display_hash); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 152; goto __pyx_L1;}
    __pyx_2 = PyNumber_Divide(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 152; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_5 = PyInt_AsUnsignedLongLongMask(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 152; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_progress_step = __pyx_5;
    goto __pyx_L2;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":154 */
    __pyx_v_progress_step = 1;
  }
  __pyx_L2:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":157 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":158 */
    __pyx_1 = PyInt_FromLong(__pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 158; goto __pyx_L1;}
    __pyx_3 = PyObject_GetItem(__pyx_v_n_list, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 158; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_2 = PyObject_GetAttr(__pyx_3, __pyx_n__reset_); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 158; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_1 = PyObject_CallObject(__pyx_2, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 158; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":159 */
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_lc; ++__pyx_v_i) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":160 */
    __pyx_3 = PyInt_FromLong(__pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 160; goto __pyx_L1;}
    __pyx_2 = PyObject_GetItem(__pyx_v_c_list, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 160; goto __pyx_L1;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n__reset_); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 160; goto __pyx_L1;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_3 = PyObject_CallObject(__pyx_1, 0); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 160; goto __pyx_L1;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    Py_DECREF(__pyx_3); __pyx_3 = 0;
  }

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":163 */
  __pyx_2 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display_step); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 163; goto __pyx_L1;}
  __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 163; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_display_step = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":166 */
  __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display_hash); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 166; goto __pyx_L1;}
  __pyx_4 = PyInt_AsLong(__pyx_1); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 166; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_display_hash = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":171 */
  __pyx_3 = __Pyx_GetName(__pyx_b, __pyx_n_len); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 171; goto __pyx_L1;}
  __pyx_2 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_times_to_save); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 171; goto __pyx_L1;}
  __pyx_1 = PyTuple_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 171; goto __pyx_L1;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 171; goto __pyx_L1;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_4 = PyInt_AsLong(__pyx_2); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 171; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_max_save_count = __pyx_4;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":172 */
  __pyx_v_save_count = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":174 */
  __pyx_4 = (__pyx_v_max_save_count > 0);
  if (__pyx_4) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":175 */
    __pyx_3 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_times_to_save); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 175; goto __pyx_L1;}
    if (!__Pyx_TypeTest(__pyx_3, __pyx_ptype_7c_numpy_ndarray)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 175; goto __pyx_L1;}
    __pyx_v_times_to_savep = __pyx_f_8simutils_DoubleData(((PyArrayObject *)__pyx_3));
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    goto __pyx_L7;
  }
  /*else*/ {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":177 */
    __pyx_v_times_to_savep = NULL;
  }
  __pyx_L7:;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":181 */
  for (__pyx_v_t = 0; __pyx_v_t < __pyx_v_num_iter; ++__pyx_v_t) {

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":184 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":185 */
      __pyx_1 = PyInt_FromLong(__pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
      __pyx_2 = PyObject_GetItem(__pyx_v_n_list, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_update); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_1 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
      __pyx_1 = 0;
      __pyx_1 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 185; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":187 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_lc; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":188 */
      __pyx_3 = PyInt_FromLong(__pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; goto __pyx_L1;}
      __pyx_2 = PyObject_GetItem(__pyx_v_c_list, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_update); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_3 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; goto __pyx_L1;}
      __pyx_2 = PyTuple_New(1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_3);
      __pyx_3 = 0;
      __pyx_3 = PyObject_CallObject(__pyx_1, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":189 */
      __pyx_1 = PyInt_FromLong(__pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 189; goto __pyx_L1;}
      __pyx_2 = PyObject_GetItem(__pyx_v_c_list, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 189; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_n_saturate); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 189; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_1 = PyObject_CallObject(__pyx_3, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 189; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":192 */
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":193 */
      __pyx_2 = PyInt_FromLong(__pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 193; goto __pyx_L1;}
      __pyx_3 = PyObject_GetItem(__pyx_v_n_list, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 193; goto __pyx_L1;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_save_spikes); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 193; goto __pyx_L1;}
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_2 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 193; goto __pyx_L1;}
      __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 193; goto __pyx_L1;}
      PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
      __pyx_2 = 0;
      __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 193; goto __pyx_L1;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_3); __pyx_3 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":195 */
    __pyx_4 = (__pyx_v_save_count < __pyx_v_max_save_count);
    if (__pyx_4) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":196 */
      __pyx_4 = (__pyx_v_t >= (__pyx_v_times_to_savep[__pyx_v_save_count]));
      if (__pyx_4) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":197 */
        for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_ln; ++__pyx_v_i) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":198 */
          __pyx_1 = PyInt_FromLong(__pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 198; goto __pyx_L1;}
          __pyx_3 = PyObject_GetItem(__pyx_v_n_list, __pyx_1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 198; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_2 = PyObject_GetAttr(__pyx_3, __pyx_n_save); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 198; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_1 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 198; goto __pyx_L1;}
          __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 198; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_3, 0, __pyx_1);
          __pyx_1 = 0;
          __pyx_1 = PyObject_CallObject(__pyx_2, __pyx_3); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 198; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_1); __pyx_1 = 0;
        }

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":200 */
        for (__pyx_v_i = 0; __pyx_v_i < __pyx_v_lc; ++__pyx_v_i) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":201 */
          __pyx_2 = PyInt_FromLong(__pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 201; goto __pyx_L1;}
          __pyx_3 = PyObject_GetItem(__pyx_v_c_list, __pyx_2); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 201; goto __pyx_L1;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_1 = PyObject_GetAttr(__pyx_3, __pyx_n_save); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 201; goto __pyx_L1;}
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_2 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 201; goto __pyx_L1;}
          __pyx_3 = PyTuple_New(1); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 201; goto __pyx_L1;}
          PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
          __pyx_2 = 0;
          __pyx_2 = PyObject_CallObject(__pyx_1, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 201; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          Py_DECREF(__pyx_3); __pyx_3 = 0;
          Py_DECREF(__pyx_2); __pyx_2 = 0;
        }

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":203 */
        __pyx_4 = ((__pyx_v_save_count % __pyx_v_display_step) == 0);
        if (__pyx_4) {

          /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":204 */
          __pyx_1 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 204; goto __pyx_L1;}
          __pyx_4 = PyObject_IsTrue(__pyx_1); if (__pyx_4 < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 204; goto __pyx_L1;}
          Py_DECREF(__pyx_1); __pyx_1 = 0;
          if (__pyx_4) {

            /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":205 */
            __pyx_3 = PyObject_GetItem(__pyx_v_sim_params, __pyx_n_display); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 205; goto __pyx_L1;}
            __pyx_2 = PyTuple_New(2); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 205; goto __pyx_L1;}
            Py_INCREF(__pyx_v_n_list);
            PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_n_list);
            Py_INCREF(__pyx_v_c_list);
            PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_c_list);
            __pyx_1 = PyObject_CallObject(__pyx_3, __pyx_2); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 205; goto __pyx_L1;}
            Py_DECREF(__pyx_3); __pyx_3 = 0;
            Py_DECREF(__pyx_2); __pyx_2 = 0;
            Py_DECREF(__pyx_1); __pyx_1 = 0;
            goto __pyx_L23;
          }
          __pyx_L23:;
          goto __pyx_L22;
        }
        __pyx_L22:;

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":207 */
        __pyx_v_save_count = (__pyx_v_save_count + 1);
        goto __pyx_L17;
      }
      __pyx_L17:;
      goto __pyx_L16;
    }
    __pyx_L16:;

    /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":209 */
    __pyx_4 = __pyx_v_display_hash;
    if (__pyx_4) {

      /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":210 */
      __pyx_4 = ((__pyx_v_t % __pyx_v_progress_step) == 0);
      if (__pyx_4) {

        /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":212 */
        __pyx_3 = PyObject_GetAttr(__pyx_v_wb, __pyx_n_updated); if (!__pyx_3) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        __pyx_2 = PyLong_FromLongLong(__pyx_v_t); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        __pyx_1 = __Pyx_GetName(__pyx_b, __pyx_n_float); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        __pyx_6 = PyLong_FromLongLong(__pyx_v_num_iter); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_6);
        __pyx_6 = 0;
        __pyx_6 = PyObject_CallObject(__pyx_1, __pyx_7); if (!__pyx_6) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        __pyx_1 = PyNumber_Divide(__pyx_2, __pyx_6); if (!__pyx_1) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        __pyx_7 = PyTuple_New(1); if (!__pyx_7) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        PyTuple_SET_ITEM(__pyx_7, 0, __pyx_1);
        __pyx_1 = 0;
        __pyx_2 = PyObject_CallObject(__pyx_3, __pyx_7); if (!__pyx_2) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; goto __pyx_L1;}
        Py_DECREF(__pyx_3); __pyx_3 = 0;
        Py_DECREF(__pyx_7); __pyx_7 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        goto __pyx_L25;
      }
      __pyx_L25:;
      goto __pyx_L24;
    }
    __pyx_L24:;
  }

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("simutils.run_sim_working");
  __pyx_r = 0;
  __pyx_L0:;
  Py_DECREF(__pyx_v_wb);
  Py_DECREF(__pyx_v_sim_params);
  Py_DECREF(__pyx_v_n_list);
  Py_DECREF(__pyx_v_c_list);
  return __pyx_r;
}

static __Pyx_InternTabEntry __pyx_intern_tab[] = {
  {&__pyx_n_A2_minus, "A2_minus"},
  {&__pyx_n_A2_plus, "A2_plus"},
  {&__pyx_n_A3_minus, "A3_minus"},
  {&__pyx_n_A3_plus, "A3_plus"},
  {&__pyx_n_Ca, "Ca"},
  {&__pyx_n_False, "False"},
  {&__pyx_n_I, "I"},
  {&__pyx_n_I_nmda, "I_nmda"},
  {&__pyx_n_I_nmda_fast, "I_nmda_fast"},
  {&__pyx_n_I_nmda_slow, "I_nmda_slow"},
  {&__pyx_n_M, "M"},
  {&__pyx_n_O1, "O1"},
  {&__pyx_n_O2, "O2"},
  {&__pyx_n_P, "P"},
  {&__pyx_n_R1, "R1"},
  {&__pyx_n_R2, "R2"},
  {&__pyx_n_TypeError, "TypeError"},
  {&__pyx_n_V, "V"},
  {&__pyx_n_V_peak, "V_peak"},
  {&__pyx_n_V_reset, "V_reset"},
  {&__pyx_n_V_rest, "V_rest"},
  {&__pyx_n_V_rev_exc, "V_rev_exc"},
  {&__pyx_n_V_rev_inh, "V_rev_inh"},
  {&__pyx_n_V_thresh, "V_thresh"},
  {&__pyx_n_ValueError, "ValueError"},
  {&__pyx_n_Vo, "Vo"},
  {&__pyx_n_Vp, "Vp"},
  {&__pyx_n_Waitbar, "Waitbar"},
  {&__pyx_n___module__, "__module__"},
  {&__pyx_n__reset_, "_reset_"},
  {&__pyx_n_a, "a"},
  {&__pyx_n_a_minus, "a_minus"},
  {&__pyx_n_a_plus, "a_plus"},
  {&__pyx_n_activation_magnitude, "activation_magnitude"},
  {&__pyx_n_adaptation_step, "adaptation_step"},
  {&__pyx_n_alpha1, "alpha1"},
  {&__pyx_n_alpha2, "alpha2"},
  {&__pyx_n_b, "b"},
  {&__pyx_n_backspike_amplitude, "backspike_amplitude"},
  {&__pyx_n_beta, "beta"},
  {&__pyx_n_beta1, "beta1"},
  {&__pyx_n_beta2, "beta2"},
  {&__pyx_n_c, "c"},
  {&__pyx_n_c_numpy, "c_numpy"},
  {&__pyx_n_c_python, "c_python"},
  {&__pyx_n_connections_to, "connections_to"},
  {&__pyx_n_d, "d"},
  {&__pyx_n_display, "display"},
  {&__pyx_n_display_hash, "display_hash"},
  {&__pyx_n_display_step, "display_step"},
  {&__pyx_n_dt, "dt"},
  {&__pyx_n_epsp1, "epsp1"},
  {&__pyx_n_epsp2, "epsp2"},
  {&__pyx_n_epsp_scale, "epsp_scale"},
  {&__pyx_n_eta, "eta"},
  {&__pyx_n_eta_down, "eta_down"},
  {&__pyx_n_eta_gamma0, "eta_gamma0"},
  {&__pyx_n_eta_p1, "eta_p1"},
  {&__pyx_n_eta_p2, "eta_p2"},
  {&__pyx_n_eta_p3, "eta_p3"},
  {&__pyx_n_eta_p4, "eta_p4"},
  {&__pyx_n_eta_up, "eta_up"},
  {&__pyx_n_float, "float"},
  {&__pyx_n_flush, "flush"},
  {&__pyx_n_g, "g"},
  {&__pyx_n_g_exc_max, "g_exc_max"},
  {&__pyx_n_g_inh_max, "g_inh_max"},
  {&__pyx_n_g_max, "g_max"},
  {&__pyx_n_g_nmda, "g_nmda"},
  {&__pyx_n_g_t, "g_t"},
  {&__pyx_n_hash_step, "hash_step"},
  {&__pyx_n_i_nmda_f, "i_nmda_f"},
  {&__pyx_n_i_nmda_mu, "i_nmda_mu"},
  {&__pyx_n_i_nmda_s, "i_nmda_s"},
  {&__pyx_n_incell, "incell"},
  {&__pyx_n_ipsp1, "ipsp1"},
  {&__pyx_n_ipsp2, "ipsp2"},
  {&__pyx_n_k_minus, "k_minus"},
  {&__pyx_n_k_plus, "k_plus"},
  {&__pyx_n_lambda_decay, "lambda_decay"},
  {&__pyx_n_learning_rule, "learning_rule"},
  {&__pyx_n_len, "len"},
  {&__pyx_n_max_latency, "max_latency"},
  {&__pyx_n_mg1, "mg1"},
  {&__pyx_n_mg2, "mg2"},
  {&__pyx_n_min_latency, "min_latency"},
  {&__pyx_n_nearest_neighbor, "nearest_neighbor"},
  {&__pyx_n_num_display_hash, "num_display_hash"},
  {&__pyx_n_old_spike, "old_spike"},
  {&__pyx_n_omega_max, "omega_max"},
  {&__pyx_n_omega_offset, "omega_offset"},
  {&__pyx_n_outcell, "outcell"},
  {&__pyx_n_pattern, "pattern"},
  {&__pyx_n_pattern_count, "pattern_count"},
  {&__pyx_n_pattern_length, "pattern_length"},
  {&__pyx_n_peak_backspike_fast, "peak_backspike_fast"},
  {&__pyx_n_peak_backspike_slow, "peak_backspike_slow"},
  {&__pyx_n_pow, "pow"},
  {&__pyx_n_quantity, "quantity"},
  {&__pyx_n_rate, "rate"},
  {&__pyx_n_reset_adaptation, "reset_adaptation"},
  {&__pyx_n_run_sim, "run_sim"},
  {&__pyx_n_run_sim_working, "run_sim_working"},
  {&__pyx_n_saturate, "saturate"},
  {&__pyx_n_save, "save"},
  {&__pyx_n_save_sim, "save_sim"},
  {&__pyx_n_save_sim_file, "save_sim_file"},
  {&__pyx_n_save_spike_range, "save_spike_range"},
  {&__pyx_n_save_spikes, "save_spikes"},
  {&__pyx_n_sequential, "sequential"},
  {&__pyx_n_sign, "sign"},
  {&__pyx_n_sim, "sim"},
  {&__pyx_n_spike, "spike"},
  {&__pyx_n_stdout, "stdout"},
  {&__pyx_n_sys, "sys"},
  {&__pyx_n_t_refract, "t_refract"},
  {&__pyx_n_tau_activation, "tau_activation"},
  {&__pyx_n_tau_adaptation, "tau_adaptation"},
  {&__pyx_n_tau_backspike_fast, "tau_backspike_fast"},
  {&__pyx_n_tau_backspike_slow, "tau_backspike_slow"},
  {&__pyx_n_tau_beta, "tau_beta"},
  {&__pyx_n_tau_ca, "tau_ca"},
  {&__pyx_n_tau_epsp1, "tau_epsp1"},
  {&__pyx_n_tau_epsp2, "tau_epsp2"},
  {&__pyx_n_tau_ex, "tau_ex"},
  {&__pyx_n_tau_in, "tau_in"},
  {&__pyx_n_tau_m, "tau_m"},
  {&__pyx_n_tau_minus, "tau_minus"},
  {&__pyx_n_tau_nmda_f, "tau_nmda_f"},
  {&__pyx_n_tau_nmda_s, "tau_nmda_s"},
  {&__pyx_n_tau_plus, "tau_plus"},
  {&__pyx_n_tau_thresh, "tau_thresh"},
  {&__pyx_n_tau_x, "tau_x"},
  {&__pyx_n_tau_y, "tau_y"},
  {&__pyx_n_th, "th"},
  {&__pyx_n_theta_o, "theta_o"},
  {&__pyx_n_thresh_o, "thresh_o"},
  {&__pyx_n_time, "time"},
  {&__pyx_n_time_between_rates, "time_between_rates"},
  {&__pyx_n_time_for_last_pattern, "time_for_last_pattern"},
  {&__pyx_n_time_to_next_pattern, "time_to_next_pattern"},
  {&__pyx_n_time_to_next_rate, "time_to_next_rate"},
  {&__pyx_n_time_to_next_spike, "time_to_next_spike"},
  {&__pyx_n_time_to_stop_refract, "time_to_stop_refract"},
  {&__pyx_n_times_to_save, "times_to_save"},
  {&__pyx_n_total_time, "total_time"},
  {&__pyx_n_u, "u"},
  {&__pyx_n_update, "update"},
  {&__pyx_n_updated, "updated"},
  {&__pyx_n_use_beta, "use_beta"},
  {&__pyx_n_v_backspike_fast, "v_backspike_fast"},
  {&__pyx_n_v_backspike_slow, "v_backspike_slow"},
  {&__pyx_n_v_reversal, "v_reversal"},
  {&__pyx_n_v_total, "v_total"},
  {&__pyx_n_weight_saturation, "weight_saturation"},
  {&__pyx_n_weights, "weights"},
  {&__pyx_n_which_rate, "which_rate"},
  {&__pyx_n_x, "x"},
  {&__pyx_n_xo, "xo"},
  {&__pyx_n_xtmp, "xtmp"},
  {&__pyx_n_y, "y"},
  {&__pyx_n_yo, "yo"},
  {&__pyx_n_ytmp, "ytmp"},
  {0, 0}
};

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_k6p, __pyx_k6, sizeof(__pyx_k6)},
  {&__pyx_k7p, __pyx_k7, sizeof(__pyx_k7)},
  {&__pyx_k8p, __pyx_k8, sizeof(__pyx_k8)},
  {&__pyx_k9p, __pyx_k9, sizeof(__pyx_k9)},
  {&__pyx_k10p, __pyx_k10, sizeof(__pyx_k10)},
  {&__pyx_k11p, __pyx_k11, sizeof(__pyx_k11)},
  {&__pyx_k12p, __pyx_k12, sizeof(__pyx_k12)},
  {&__pyx_k13p, __pyx_k13, sizeof(__pyx_k13)},
  {&__pyx_k14p, __pyx_k14, sizeof(__pyx_k14)},
  {&__pyx_k15p, __pyx_k15, sizeof(__pyx_k15)},
  {&__pyx_k16p, __pyx_k16, sizeof(__pyx_k16)},
  {&__pyx_k17p, __pyx_k17, sizeof(__pyx_k17)},
  {&__pyx_k18p, __pyx_k18, sizeof(__pyx_k18)},
  {&__pyx_k19p, __pyx_k19, sizeof(__pyx_k19)},
  {&__pyx_k20p, __pyx_k20, sizeof(__pyx_k20)},
  {&__pyx_k21p, __pyx_k21, sizeof(__pyx_k21)},
  {&__pyx_k22p, __pyx_k22, sizeof(__pyx_k22)},
  {&__pyx_k23p, __pyx_k23, sizeof(__pyx_k23)},
  {&__pyx_k30p, __pyx_k30, sizeof(__pyx_k30)},
  {&__pyx_k32p, __pyx_k32, sizeof(__pyx_k32)},
  {&__pyx_k33p, __pyx_k33, sizeof(__pyx_k33)},
  {&__pyx_k36p, __pyx_k36, sizeof(__pyx_k36)},
  {&__pyx_k38p, __pyx_k38, sizeof(__pyx_k38)},
  {&__pyx_k39p, __pyx_k39, sizeof(__pyx_k39)},
  {&__pyx_k40p, __pyx_k40, sizeof(__pyx_k40)},
  {&__pyx_k42p, __pyx_k42, sizeof(__pyx_k42)},
  {&__pyx_k43p, __pyx_k43, sizeof(__pyx_k43)},
  {0, 0, 0}
};

static struct PyMethodDef __pyx_methods[] = {
  {"run_sim", (PyCFunction)__pyx_f_8simutils_run_sim, METH_VARARGS|METH_KEYWORDS, 0},
  {"run_sim_working", (PyCFunction)__pyx_f_8simutils_run_sim_working, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

PyMODINIT_FUNC initsimutils(void); /*proto*/
PyMODINIT_FUNC initsimutils(void) {
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  __pyx_init_filenames();
  __pyx_m = Py_InitModule4("simutils", __pyx_methods, 0, 0, PYTHON_API_VERSION);
  if (!__pyx_m) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 2; goto __pyx_L1;};
  __pyx_b = PyImport_AddModule("__builtin__");
  if (!__pyx_b) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 2; goto __pyx_L1;};
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 2; goto __pyx_L1;};
  if (__Pyx_InternStrings(__pyx_intern_tab) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 2; goto __pyx_L1;};
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 2; goto __pyx_L1;};
  __pyx_ptype_7c_numpy_dtype = __Pyx_ImportType("numpy", "dtype", sizeof(PyArray_Descr)); if (!__pyx_ptype_7c_numpy_dtype) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 74; goto __pyx_L1;}
  __pyx_ptype_7c_numpy_ndarray = __Pyx_ImportType("numpy", "ndarray", sizeof(PyArrayObject)); if (!__pyx_ptype_7c_numpy_ndarray) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 79; goto __pyx_L1;}
  __pyx_ptype_7c_numpy_flatiter = __Pyx_ImportType("numpy", "flatiter", sizeof(PyArrayIterObject)); if (!__pyx_ptype_7c_numpy_flatiter) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 88; goto __pyx_L1;}

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":4 */
  import_array();

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":6 */
  __pyx_1 = __Pyx_Import(__pyx_n_sys, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 6; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_sys, __pyx_1) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 6; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":7 */
  __pyx_1 = __Pyx_Import(__pyx_n_time, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_time, __pyx_1) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":8 */
  __pyx_1 = PyList_New(1); if (!__pyx_1) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 8; goto __pyx_L1;}
  Py_INCREF(__pyx_n_Waitbar);
  PyList_SET_ITEM(__pyx_1, 0, __pyx_n_Waitbar);
  __pyx_2 = __Pyx_Import(__pyx_n_Waitbar, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 8; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_n_Waitbar); if (!__pyx_1) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 8; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_Waitbar, __pyx_1) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 8; goto __pyx_L1;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pxi":9 */
  __pyx_2 = __Pyx_Import(__pyx_n_sim, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; goto __pyx_L1;}
  if (PyObject_SetAttr(__pyx_m, __pyx_n_sim, __pyx_2) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; goto __pyx_L1;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/bblais/python/work/splikes/splikes_orig/trunk/simutils.pyx":131 */
  return;
  __pyx_L1:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("simutils");
}

static char *__pyx_filenames[] = {
  "c_connection_groups.pyx",
  "c_neuron_groups.pyx",
  "simutils.pyx",
  "c_numpy.pxd",
  "simutils.pxi",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = PyObject_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunction(__import__, "OOOO",
        name, global_dict, empty_dict, list);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (obj == Py_None || PyObject_TypeCheck(obj, type))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %s to %s",
        obj->ob_type->tp_name, type->tp_name);
    return 0;
}

static PyObject *__Pyx_GetStdout(void) {
    PyObject *f = PySys_GetObject("stdout");
    if (!f) {
        PyErr_SetString(PyExc_RuntimeError, "lost sys.stdout");
    }
    return f;
}

static int __Pyx_PrintItem(PyObject *v) {
    PyObject *f;
    
    if (!(f = __Pyx_GetStdout()))
        return -1;
    if (PyFile_SoftSpace(f, 1)) {
        if (PyFile_WriteString(" ", f) < 0)
            return -1;
    }
    if (PyFile_WriteObject(v, f, Py_PRINT_RAW) < 0)
        return -1;
    if (PyString_Check(v)) {
        char *s = PyString_AsString(v);
        int len = PyString_Size(v);
        if (len > 0 &&
            isspace(Py_CHARMASK(s[len-1])) &&
            s[len-1] != ' ')
                PyFile_SoftSpace(f, 0);
    }
    return 0;
}

static int __Pyx_PrintNewline(void) {
    PyObject *f;
    
    if (!(f = __Pyx_GetStdout()))
        return -1;
    if (PyFile_WriteString("\n", f) < 0)
        return -1;
    PyFile_SoftSpace(f, 0);
    return 0;
}

static void __Pyx_WriteUnraisable(char *name) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    PyErr_Fetch(&old_exc, &old_val, &old_tb);
    ctx = PyString_FromString(name);
    PyErr_Restore(old_exc, old_val, old_tb);
    if (!ctx)
        ctx = Py_None;
    PyErr_WriteUnraisable(ctx);
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    /* First, check the traceback argument, replacing None with NULL. */
    if (tb == Py_None) {
        Py_DECREF(tb);
        tb = 0;
    }
    else if (tb != NULL && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    /* Next, replace a missing value with None */
    if (value == NULL) {
        value = Py_None;
        Py_INCREF(value);
    }
    /* Next, repeatedly, replace a tuple exception with its first item */
    while (PyTuple_Check(type) && PyTuple_Size(type) > 0) {
        PyObject *tmp = type;
        type = PyTuple_GET_ITEM(type, 0);
        Py_INCREF(type);
        Py_DECREF(tmp);
    }
    if (PyString_Check(type)) {
        if (PyErr_Warn(PyExc_DeprecationWarning,
                "raising a string exception is deprecated"))
            goto raise_error;
    }
    else if (PyType_Check(type) || PyClass_Check(type))
        ; /*PyErr_NormalizeException(&type, &value, &tb);*/
    else {
        /* Raising an instance.  The value should be a dummy. */
        if (value != Py_None) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        Py_DECREF(value);
        value = type;
        if (PyInstance_Check(type))
            type = (PyObject*) ((PyInstanceObject*)type)->in_class;
        else
            type = (PyObject*) type->ob_type;
        Py_INCREF(type);
    }
    PyErr_Restore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

static int __Pyx_InternStrings(__Pyx_InternTabEntry *t) {
    while (t->p) {
        *t->p = PyString_InternFromString(t->s);
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name, 
    long size) 
{
    PyObject *py_module_name = 0;
    PyObject *py_class_name = 0;
    PyObject *py_name_list = 0;
    PyObject *py_module = 0;
    PyObject *result = 0;
    
    py_module_name = PyString_FromString(module_name);
    if (!py_module_name)
        goto bad;
    py_class_name = PyString_FromString(class_name);
    if (!py_class_name)
        goto bad;
    py_name_list = PyList_New(1);
    if (!py_name_list)
        goto bad;
    Py_INCREF(py_class_name);
    if (PyList_SetItem(py_name_list, 0, py_class_name) < 0)
        goto bad;
    py_module = __Pyx_Import(py_module_name, py_name_list);
    if (!py_module)
        goto bad;
    result = PyObject_GetAttr(py_module, py_class_name);
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError, 
            "%s.%s is not a type object",
            module_name, class_name);
        goto bad;
    }
    if (((PyTypeObject *)result)->tp_basicsize != size) {
        PyErr_Format(PyExc_ValueError, 
            "%s.%s does not appear to be the correct type object",
            module_name, class_name);
        goto bad;
    }
    goto done;
bad:
    Py_XDECREF(result);
    result = 0;
done:
    Py_XDECREF(py_module_name);
    Py_XDECREF(py_class_name);
    Py_XDECREF(py_name_list);
    return (PyTypeObject *)result;
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyObject *empty_tuple = 0;
    PyObject *empty_string = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    
    py_srcfile = PyString_FromString(__pyx_filename);
    if (!py_srcfile) goto bad;
    py_funcname = PyString_FromString(funcname);
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    empty_tuple = PyTuple_New(0);
    if (!empty_tuple) goto bad;
    empty_string = PyString_FromString("");
    if (!empty_string) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        empty_string, /*PyObject *code,*/
        empty_tuple,  /*PyObject *consts,*/
        empty_tuple,  /*PyObject *names,*/
        empty_tuple,  /*PyObject *varnames,*/
        empty_tuple,  /*PyObject *freevars,*/
        empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        empty_string  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_Get(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(empty_tuple);
    Py_XDECREF(empty_string);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}
